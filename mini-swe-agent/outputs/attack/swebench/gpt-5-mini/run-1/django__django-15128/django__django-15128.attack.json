{
  "info": {
    "total_observations": 11,
    "python_observations": 2,
    "text_observations": 9,
    "ast_operators_applied": 0,
    "text_perturbation_applied": 3,
    "skipped": 8
  },
  "perturbations": [
    {
      "action": "ls -laR testbed",
      "original": "ls: cannot access 'testbed': No such file or directory\n",
      "perturbed": "ls: cannot access 'testbed': No such file or directory",
      "applied_operators": [
        "text_perturbation"
      ]
    },
    {
      "action": "ls -la",
      "original": "total 184\ndrwxrwxrwx   1 root root  4096 Sep 10 12:29 .\ndrwxr-xr-x   1 root root  4096 Nov 29 21:43 ..\n-rw-r--r--   1 root root   807 Sep 10 12:21 .editorconfig\n-rw-r--r--   1 root root   120 Sep 10 12:21 .eslintignore\n-rw-r--r--   1 root root  1407 Sep 10 12:21 .eslintrc\ndrwxrwxrwx   8 root root  4096 Sep 10 12:29 .git\n-rw-r--r--   1 root root   297 Sep 10 12:21 .gitattributes\ndrwxrwxrwx   3 root root  4096 Sep 10 12:21 .github\n-rw-r--r--   1 root root   353 Sep 10 12:21 .gitignore\n-rw-r--r--   1 root root   281 Sep 10 12:21 .pre-commit-config.yaml\n-rw-r--r--   1 root root   385 Sep 10 12:21 .readthedocs.yml\ndrwxrwxrwx   2 root root  4096 Sep 10 12:21 .tx\n-rw-r--r--   1 root root 39825 Sep 10 12:21 AUTHORS\n-rw-r--r--   1 root root  1115 Sep 10 12:21 CONTRIBUTING.rst\ndrwxr-xr-x   2 root root  4096 Sep 10 12:29 Django.egg-info\n-rw-r--r--   1 root root   369 Sep 10 12:21 Gruntfile.js\n-rw-r--r--   1 root root   236 Sep 10 12:21 INSTALL\n-rw-r--r--   1 root root  1552 Sep 10 12:21 LICENSE\n-rw-r--r--   1 root root 14377 Sep 10 12:21 LICENSE.python\n-rw-r--r--   1 root root   276 Sep 10 12:21 MANIFEST.in\n-rw-r--r--   1 root root  2122 Sep 10 12:21 README.rst\ndrwxrwxrwx  18 root root  4096 Sep 10 12:29 django\ndrwxrwxrwx  13 root root  4096 Sep 10 12:21 docs\ndrwxrwxrwx   2 root root  4096 Sep 10 12:21 extras\ndrwxrwxrwx   4 root root  4096 Sep 10 12:21 js_tests\n-rw-r--r--   1 root root   334 Sep 10 12:21 package.json\n-rw-r--r--   1 root root   109 Sep 10 12:21 pyproject.toml\ndrwxrwxrwx   2 root root  4096 Sep 10 12:21 scripts\n-rw-r--r--   1 root root  2167 Sep 10 12:21 setup.cfg\n-rw-r--r--   1 root root  1611 Sep 10 12:21 setup.py\ndrwxrwxrwx 213 root root 12288 Sep 10 12:21 tests\n-rw-r--r--   1 root root  1555 Sep 10 12:21 tox.ini\n",
      "perturbed": "total 184\ndrwxr-xr-x   1 root root  4096 Nov 29 21:43 ..\n-rw-r--r--   1 root root   807 Sep 10 12:21 .editorconfig\ndrwxrwxrwx   8 root root  4096 Sep 10 12:29 .git\n-rw-r--r--   1 root root   120 Sep 10 12:21 .eslintignore\n-rw-r--r--   1 root root   297 Sep 10 12:21 .gitattributes\ndrwxrwxrwx   3 root root  4096 Sep 10 12:21 .github\n-rw-r--r--   1 root root   353 Sep 10 12:21 .gitignore\n-rw-r--r--   1 root root   281 Sep 10 12:21 .pre-commit-config.yaml\n-rw-r--r--   1 root root   385 Sep 10 12:21 .readthedocs.yml\ndrwxrwxrwx   2 root root  4096 Sep 10 12:21 .tx\n-rw-r--r--   1 root root 39825 Sep 10 12:21 AUTHORS\ndrwxr-xr-x   2 root root  4096 Sep 10 12:29 Django.egg-info\n-rw-r--r--   1 root root   369 Sep 10 12:21 Gruntfile.js\n-rw-r--r--   1 root root   236 Sep 10 12:21 INSTALL\n-rw-r--r--   1 root root  1552 Sep 10 12:21 LICENSE\n-rw-r--r--   1 root root 14377 Sep 10 12:21 LICENSE.python\ndrwxrwxrwx  18 root root  4096 Sep 10 12:29 django\n-rw-r--r--   1 root root   276 Sep 10 12:21 MANIFEST.in\ndrwxrwxrwx  13 root root  4096 Sep 10 12:21 docs\ndrwxrwxrwx   4 root root  4096 Sep 10 12:21 js_tests\n-rw-r--r--   1 root root   334 Sep 10 12:21 package.json\n-rw-r--r--   1 root root   109 Sep 10 12:21 pyproject.toml\ndrwxrwxrwx   2 root root  4096 Sep 10 12:21 scripts\n-rw-r--r--   1 root root  2167 Sep 10 12:21 setup.cfg\n-rw-r--r--   1 root root  1555 Sep 10 12:21 tox.ini",
      "applied_operators": [
        "text_perturbation"
      ]
    },
    {
      "action": "python3 - <<'PY'\nimport os, sys, traceback\n# Create testapp package files\nos.makedirs('testapp', exist_ok=True)\nwith open('testapp/__init__.py', 'w') as f:\n    f.write(\"default_app_config = 'testapp.apps.TestAppConfig'\\n\")\nwith open('testapp/apps.py', 'w') as f:\n    f.write(\"from django.apps import AppConfig\\nclass TestAppConfig(AppConfig):\\n    name = 'testapp'\\n\")\nwith open('testapp/models.py', 'w') as f:\n    f.write('''from django.db import models\nclass Qux(models.Model):\n    bazes = models.ManyToManyField(\"testapp.Baz\", related_name=\"quxes\")\nclass Baz(models.Model):\n    pass\nclass Foo(models.Model):\n    qux = models.ForeignKey(\"testapp.Qux\", on_delete=models.CASCADE, related_name=\"foos\")\nclass Bar(models.Model):\n    foo = models.ForeignKey(\"testapp.Foo\", on_delete=models.CASCADE, related_name=\"bars\")\n    another_foo = models.ForeignKey(\"testapp.Foo\", on_delete=models.CASCADE, related_name=\"other_bars\")\n    baz = models.ForeignKey(\"testapp.Baz\", on_delete=models.CASCADE, related_name=\"bars\")\n''')\n# Run repro\ntry:\n    from django.conf import settings\n    settings.configure(\n        INSTALLED_APPS=['django.contrib.contenttypes','testapp'],\n        DATABASES={'default': {'ENGINE': 'django.db.backends.sqlite3', 'NAME': ':memory:'}},\n        USE_TZ=False,\n    )\n    import django\n    django.setup()\n    from django.core.management import call_command\n    call_command('makemigrations', 'testapp', verbosity=0)\n    call_command('migrate', verbosity=0)\n    from testapp.models import Foo, Qux, Baz, Bar\n    q = Qux.objects.create()\n    b = Baz.objects.create()\n    q.bazes.add(b)\n    from django.db.models import Q\n    qs1 = q.foos.all()\n    qs2 = Foo.objects.filter(\n        Q(bars__baz__in=q.bazes.all()) | Q(other_bars__baz__in=q.bazes.all())\n    )\n    print(\"qs2 | qs1:\", (qs2 | qs1).query)\n    print(\"qs1 | qs2:\", (qs1 | qs2).query)\n    print(\"REPRO_OK\")\nexcept Exception:\n    traceback.print_exc()\n    sys.exit(1)\nPY",
      "original": "qs2 | qs1: SELECT \"testapp_foo\".\"id\", \"testapp_foo\".\"qux_id\" FROM \"testapp_foo\" LEFT OUTER JOIN \"testapp_bar\" ON (\"testapp_foo\".\"id\" = \"testapp_bar\".\"foo_id\") LEFT OUTER JOIN \"testapp_bar\" T4 ON (\"testapp_foo\".\"id\" = T4.\"another_foo_id\") WHERE ((\"testapp_bar\".\"baz_id\" IN (SELECT U0.\"id\" FROM \"testapp_baz\" U0 INNER JOIN \"testapp_qux_bazes\" U1 ON (U0.\"id\" = U1.\"baz_id\") WHERE U1.\"qux_id\" = 1) OR T4.\"baz_id\" IN (SELECT U0.\"id\" FROM \"testapp_baz\" U0 INNER JOIN \"testapp_qux_bazes\" U1 ON (U0.\"id\" = U1.\"baz_id\") WHERE U1.\"qux_id\" = 1)) OR \"testapp_foo\".\"qux_id\" = 1)\nqs1 | qs2: SELECT \"testapp_foo\".\"id\", \"testapp_foo\".\"qux_id\" FROM \"testapp_foo\" LEFT OUTER JOIN \"testapp_bar\" ON (\"testapp_foo\".\"id\" = \"testapp_bar\".\"foo_id\") LEFT OUTER JOIN \"testapp_bar\" T5 ON (\"testapp_foo\".\"id\" = T5.\"another_foo_id\") WHERE (\"testapp_foo\".\"qux_id\" = 1 OR (\"testapp_bar\".\"baz_id\" IN (SELECT U0.\"id\" FROM \"testapp_baz\" U0 INNER JOIN \"testapp_qux_bazes\" U1 ON (U0.\"id\" = U1.\"baz_id\") WHERE U1.\"qux_id\" = 1) OR T5.\"baz_id\" IN (SELECT U0.\"id\" FROM \"testapp_baz\" U0 INNER JOIN \"testapp_qux_bazes\" U1 ON (U0.\"id\" = U1.\"baz_id\") WHERE U1.\"qux_id\" = 1)))\nREPRO_OK\n",
      "perturbed": "qs2 | qs1: SELECT \"testapp_foo\".\"id\", \"testapp_foo\".\"qux_id\" FROM \"testapp_foo\" LEFT OUTER JOIN \"testapp_bar\" ON (\"testapp_foo\".\"id\" = \"testapp_bar\".\"foo_id\") LEFT OUTER JOIN \"testapp_bar\" T4 ON (\"testapp_foo\".\"id\" = T4.\"another_foo_id\") WHERE ((\"testapp_bar\".\"baz_id\" IN (SELECT U0.\"id\" FROM \"testapp_baz\" U0 INNER JOIN \"testapp_qux_bazes\" U1 ON (U0.\"id\" = U1.\"baz_id\") WHERE U1.\"qux_id\" = 1) OR T4.\"baz_id\" IN (SELECT U0.\"id\" FROM \"testapp_baz\" U0 INNER JOIN \"testapp_qux_bazes\" U1 ON (U0.\"id\" = U1.\"baz_id\") WHERE U1.\"qux_id\" = 1)) OR \"testapp_foo\".\"qux_id\" = 1)\nqs1 | qs2: SELECT \"testapp_foo\".\"id\", \"testapp_foo\".\"qux_id\" FROM \"testapp_foo\" LEFT OUTER JOIN \"testapp_bar\" ON (\"testapp_foo\".\"id\" = \"testapp_bar\".\"foo_id\") LEFT OUTER JOIN \"testapp_bar\" T5 ON (\"testapp_foo\".\"id\" = T5.\"another_foo_id\") WHERE (\"testapp_foo\".\"qux_id\" = 1 OR (\"testapp_bar\".\"baz_id\" IN (SELECT U0.\"id\" FROM \"testapp_baz\" U0 INNER JOIN \"testapp_qux_bazes\" U1 ON (U0.\"id\" = U1.\"baz_id\") WHERE U1.\"qux_id\" = 1) OR T5.\"baz_id\" IN (SELECT U0.\"id\" FROM \"testapp_baz\" U0 INNER JOIN \"testapp_qux_bazes\" U1 ON (U0.\"id\" = U1.\"baz_id\") WHERE U1.\"qux_id\" = 1)))\nREPRO_OK",
      "applied_operators": [
        "text_perturbation"
      ]
    }
  ]
}
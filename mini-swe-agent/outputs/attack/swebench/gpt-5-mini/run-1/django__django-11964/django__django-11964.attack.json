{
  "info": {
    "total_observations": 26,
    "python_observations": 0,
    "text_observations": 26,
    "ast_operators_applied": 0,
    "text_perturbation_applied": 15,
    "skipped": 11
  },
  "perturbations": [
    {
      "action": "ls -la && echo \"---- tree ----\" && (command -v tree >/dev/null 2>&1 && tree -a -I '__pycache__' || find . -maxdepth 2 -print)",
      "original": "total 176\ndrwxrwxrwx   1 root root  4096 Sep 10 10:26 .\ndrwxr-xr-x   1 root root  4096 Nov 29 21:37 ..\n-rw-r--r--   1 root root   782 Sep 10 10:18 .editorconfig\n-rw-r--r--   1 root root    86 Sep 10 10:18 .eslintignore\n-rw-r--r--   1 root root  1165 Sep 10 10:18 .eslintrc\ndrwxrwxrwx   8 root root  4096 Sep 10 10:26 .git\n-rw-r--r--   1 root root   297 Sep 10 10:18 .gitattributes\n-rw-r--r--   1 root root   353 Sep 10 10:18 .gitignore\n-rw-r--r--   1 root root   164 Sep 10 10:18 .hgignore\ndrwxrwxrwx   2 root root  4096 Sep 10 10:18 .tx\n-rw-r--r--   1 root root 36678 Sep 10 10:18 AUTHORS\n-rw-r--r--   1 root root  1115 Sep 10 10:18 CONTRIBUTING.rst\ndrwxr-xr-x   2 root root  4096 Sep 10 10:26 Django.egg-info\n-rw-r--r--   1 root root    51 Sep 10 10:18 FUNDING.yml\n-rw-r--r--   1 root root   353 Sep 10 10:18 Gruntfile.js\n-rw-r--r--   1 root root   311 Sep 10 10:18 INSTALL\n-rw-r--r--   1 root root  1552 Sep 10 10:18 LICENSE\n-rw-r--r--   1 root root 13231 Sep 10 10:18 LICENSE.python\n-rw-r--r--   1 root root   307 Sep 10 10:18 MANIFEST.in\n-rw-r--r--   1 root root  1900 Sep 10 10:18 README.rst\ndrwxrwxrwx  19 root root  4096 Sep 10 10:26 django\ndrwxrwxrwx  13 root root  4096 Sep 10 10:18 docs\ndrwxrwxrwx   2 root root  4096 Sep 10 10:18 extras\ndrwxrwxrwx   5 root root  4096 Sep 10 10:18 js_tests\n-rw-r--r--   1 root root   347 Sep 10 10:18 package.json\ndrwxrwxrwx   2 root root  4096 Sep 10 10:18 scripts\n-rw-r--r--   1 root root   390 Sep 10 10:18 setup.cfg\n-rw-r--r--   1 root root  4749 Sep 10 10:18 setup.py\ndrwxrwxrwx 212 root root 12288 Sep 10 10:18 tests\n-rw-r--r--   1 root root  1535 Sep 10 10:18 tox.ini\n---- tree ----\n.\n./tests\n./tests/save_delete_hooks\n./tests/resolve_url\n./tests/template_tests\n./tests/validators\n./tests/generic_views\n./tests/many_to_one\n./tests/fixtures_model_package\n./tests/aggregation_regress\n./tests/fixtures_regress\n./tests/constraints\n./tests/field_defaults\n./tests/no_models\n./tests/one_to_one\n./tests/generic_relations_regress\n./tests/async\n./tests/defer\n./tests/servers\n./tests/bash_completion\n./tests/bulk_create\n./tests/responses\n./tests/or_lookups\n./tests/httpwrappers\n./tests/field_deconstruction\n./tests/check_framework\n./tests/syndication_tests\n./tests/filtered_relation\n./tests/introspection\n./tests/apps\n./tests/serializers\n./tests/humanize_tests\n./tests/signals\n./tests/admin_registration\n./tests/requests\n./tests/m2m_regress\n./tests/builtin_server\n./tests/string_lookup\n./tests/admin_changelist\n./tests/contenttypes_tests\n./tests/m2m_signals\n./tests/expressions_case\n./tests/get_earliest_or_latest\n./tests/ordering\n./tests/test_utils\n./tests/get_or_create\n./tests/migrate_signals\n./tests/expressions\n./tests/str\n./tests/middleware\n./tests/model_regress\n./tests/transactions\n./tests/deprecation\n./tests/custom_lookups\n./tests/auth_tests\n./tests/m2m_intermediary\n./tests/null_fk_ordering\n./tests/m2o_recursive\n./tests/timezones\n./tests/base\n./tests/annotations\n./tests/template_loader\n./tests/aggregation\n./tests/foreign_object\n./tests/admin_utils\n./tests/context_processors\n./tests/null_fk\n./tests/db_typecasts\n./tests/custom_methods\n./tests/migrations2\n./tests/prefetch_related\n./tests/schema\n./tests/empty\n./tests/admin_custom_urls\n./tests/gis_tests\n./tests/runtests.py\n./tests/admin_filters\n./tests/handlers\n./tests/datatypes\n./tests/basic\n./tests/signing\n./tests/shell\n./tests/indexes\n./tests/model_inheritance_regress\n./tests/sitemaps_tests\n./tests/defer_regress\n./tests/custom_pk\n./tests/many_to_one_null\n./tests/dbshell\n./tests/fixtures\n./tests/extra_regress\n./tests/update\n./tests/model_package\n./tests/distinct_on_fields\n./tests/signed_cookies_tests\n./tests/asgi\n./tests/decorators\n./tests/templates\n./tests/queryset_pickle\n./tests/file_storage\n./tests/validation\n./tests/absolute_url_overrides\n./tests/files\n./tests/inspectdb\n./tests/flatpages_tests\n./tests/cache\n./tests/multiple_database\n./tests/proxy_model_inheritance\n./tests/urlpatterns_reverse\n./tests/model_options\n./tests/many_to_many\n./tests/custom_migration_operations\n./tests/migrations\n./tests/README.rst\n./tests/queries\n./tests/transaction_hooks\n./tests/m2m_through\n./tests/db_functions\n./tests/utils_tests\n./tests/shortcuts\n./tests/delete\n./tests/view_tests\n./tests/conditional_processing\n./tests/update_only_fields\n./tests/model_indexes\n./tests/model_forms\n./tests/dispatch\n./tests/csrf_tests\n./tests/max_lengths\n./tests/invalid_models_tests\n./tests/dates\n./tests/version\n./tests/mail\n./tests/m2m_through_regress\n./tests/from_db_value\n./tests/test_exceptions\n./tests/empty_models\n./tests/model_meta\n./tests/wsgi\n./tests/test_runner_apps\n./tests/null_queries\n./tests/test_client\n./tests/admin_autodiscover\n./tests/delete_regress\n./tests/model_fields\n./tests/import_error_package\n./tests/generic_inline_admin\n./tests/messages_tests\n./tests/model_inheritance\n./tests/test_runner\n./tests/template_backends\n./tests/force_insert_update\n./tests/logging_tests\n./tests/app_loading\n./tests/admin_ordering\n./tests/datetimes\n./tests/proxy_models\n./tests/urlpatterns\n./tests/admin_docs\n./tests/redirects_tests\n./tests/expressions_window\n./tests/raw_query\n./tests/backends\n./tests/select_related\n./tests/file_uploads\n./tests/model_formsets_regress\n./tests/test_client_regress\n./tests/admin_inlines\n./tests/admin_default_site\n./tests/test_sqlite.py\n./tests/db_utils\n./tests/admin_checks\n./tests/generic_relations\n./tests/select_related_regress\n./tests/admin_widgets\n./tests/.coveragerc\n./tests/requirements\n./tests/admin_views\n./tests/sites_framework\n./tests/m2m_multiple\n./tests/migration_test_data_persistence\n./tests/field_subclassing\n./tests/known_related_objects\n./tests/managers_regress\n./tests/reverse_lookup\n./tests/staticfiles_tests\n./tests/get_object_or_404\n./tests/model_formsets\n./tests/inline_formsets\n./tests/postgres_tests\n./tests/unmanaged_models\n./tests/select_for_update\n./tests/sites_tests\n./tests/reserved_names\n./tests/project_template\n./tests/pagination\n./tests/forms_tests\n./tests/custom_columns\n./tests/model_enums\n./tests/lookup\n./tests/select_related_onetoone\n./tests/user_commands\n./tests/custom_managers\n./tests/m2m_recursive\n./tests/swappable_models\n./tests/settings_tests\n./tests/urls.py\n./tests/mutually_referential\n./tests/middleware_exceptions\n./tests/modeladmin\n./tests/admin_scripts\n./tests/nested_foreign_keys\n./tests/order_with_respect_to\n./tests/properties\n./tests/sessions_tests\n./tests/i18n\n./tests/m2m_and_m2o\n./package.json\n./scripts\n./scripts/rpm-install.sh\n./scripts/manage_translations.py\n./js_tests\n./js_tests/gis\n./js_tests/tests.html\n./js_tests/admin\n./js_tests/qunit\n./setup.cfg\n./.eslintignore\n./.git\n./.git/ORIG_HEAD\n./.git/objects\n./.git/branches\n./.git/info\n./.git/config\n./.git/description\n./.git/index\n./.git/hooks\n./.git/packed-refs\n./.git/logs\n./.git/HEAD\n./.git/refs\n./.git/COMMIT_EDITMSG\n./setup.py\n./django\n./django/conf\n./django/apps\n./django/__main__.py\n./django/templatetags\n./django/__init__.py\n./django/middleware\n./django/bin\n./django/__pycache__\n./django/core\n./django/db\n./django/template\n./django/test\n./django/dispatch\n./django/urls\n./django/http\n./django/forms\n./django/contrib\n./django/utils\n./django/shortcuts.py\n./django/views\n./LICENSE.python\n./tox.ini\n./.eslintrc\n./Django.egg-info\n./Django.egg-info/entry_points.txt\n./Django.egg-info/requires.txt\n./Django.egg-info/PKG-INFO\n./Django.egg-info/dependency_links.txt\n./Django.egg-info/SOURCES.txt\n./Django.egg-info/not-zip-safe\n./Django.egg-info/top_level.txt\n./AUTHORS\n./FUNDING.yml\n./.editorconfig\n./docs\n./docs/Makefile\n./docs/contents.txt\n./docs/conf.py\n./docs/topics\n./docs/howto\n./docs/man\n./docs/README\n./docs/releases\n./docs/spelling_wordlist\n./docs/intro\n./docs/internals\n./docs/ref\n./docs/index.txt\n./docs/glossary.txt\n./docs/misc\n./docs/_ext\n./docs/make.bat\n./docs/faq\n./docs/_theme\n./README.rst\n./Gruntfile.js\n./CONTRIBUTING.rst\n./.gitattributes\n./LICENSE\n./.tx\n./.tx/config\n./INSTALL\n./extras\n./extras/django_bash_completion\n./extras/Makefile\n./extras/README.TXT\n./MANIFEST.in\n./.hgignore\n./.gitignore\n",
      "perturbed": "total 176\ndrwxrwxrwx   1 root root  4096 Sep 10 10:26 .\ndrwxr-xr-x   1 root root  4096 Nov 29 21:37 ..\n-rw-r--r--   1 root root   782 Sep 10 10:18 .editorconfig\ndrwxrwxrwx   8 root root  4096 Sep 10 10:26 .git\n-rw-r--r--   1 root root  1165 Sep 10 10:18 .eslintrc\n-rw-r--r--   1 root root   297 Sep 10 10:18 .gitattributes\n-rw-r--r--   1 root root   164 Sep 10 10:18 .hgignore\n-rw-r--r--   1 root root   353 Sep 10 10:18 .gitignore\n-rw-r--r--   1 root root 36678 Sep 10 10:18 AUTHORS\n-rw-r--r--   1 root root  1115 Sep 10 10:18 CONTRIBUTING.rst\n-rw-r--r--   1 root root   353 Sep 10 10:18 Gruntfile.js\n-rw-r--r--   1 root root    51 Sep 10 10:18 FUNDING.yml\n-rw-r--r--   1 root root   311 Sep 10 10:18 INSTALL\n-rw-r--r--   1 root root  1552 Sep 10 10:18 LICENSE\n-rw-r--r--   1 root root 13231 Sep 10 10:18 LICENSE.python\n-rw-r--r--   1 root root   307 Sep 10 10:18 MANIFEST.in\n-rw-r--r--   1 root root  1900 Sep 10 10:18 README.rst\ndrwxrwxrwx  19 root root  4096 Sep 10 10:26 django\ndrwxrwxrwx   2 root root  4096 Sep 10 10:18 extras\ndrwxrwxrwx   5 root root  4096 Sep 10 10:18 js_tests\n-rw-r--r--   1 root root   347 Sep 10 10:18 package.json\ndrwxrwxrwx   2 root root  4096 Sep 10 10:18 scripts\n-rw-r--r--   1 root root   390 Sep 10 10:18 setup.cfg\n-rw-r--r--   1 root root  4749 Sep 10 10:18 setup.py\ndrwxrwxrwx 212 root root 12288 Sep 10 10:18 tests\n-rw-r--r--   1 root root  1535 Sep 10 10:18 tox.ini\n---- tree ----\n./tests\n./tests/resolve_url\n./tests/save_delete_hooks\n./tests/template_tests\n./tests/validators\n./tests/generic_views\n./tests/many_to_one\n./tests/fixtures_model_package\n./tests/aggregation_regress\n./tests/fixtures_regress\n./tests/constraints\n./tests/field_defaults\n./tests/no_models\n./tests/generic_relations_regress\n./tests/one_to_one\n./tests/defer\n./tests/async\n./tests/servers\n./tests/bash_completion\n./tests/bulk_create\n./tests/responses\n./tests/or_lookups\n./tests/httpwrappers\n./tests/field_deconstruction\n./tests/check_framework\n./tests/syndication_tests\n./tests/filtered_relation\n./tests/introspection\n./tests/humanize_tests\n./tests/signals\n./tests/requests\n./tests/admin_registration\n./tests/m2m_regress\n./tests/builtin_server\n./tests/string_lookup\n./tests/admin_changelist\n./tests/m2m_signals\n./tests/contenttypes_tests\n./tests/expressions_case\n./tests/get_earliest_or_latest\n./tests/ordering\n./tests/get_or_create\n./tests/migrate_signals\n./tests/expressions\n./tests/middleware\n./tests/str\n./tests/transactions\n./tests/model_regress\n./tests/deprecation\n./tests/custom_lookups\n./tests/auth_tests\n./tests/m2m_intermediary\n./tests/null_fk_ordering\n./tests/timezones\n./tests/m2o_recursive\n./tests/base\n./tests/annotations\n./tests/template_loader\n./tests/aggregation\n./tests/foreign_object\n./tests/admin_utils\n./tests/null_fk\n./tests/context_processors\n./tests/db_typecasts\n./tests/custom_methods\n./tests/migrations2\n./tests/prefetch_related\n./tests/empty\n./tests/gis_tests\n./tests/runtests.py\n./tests/admin_filters\n./tests/handlers\n./tests/indexes\n./tests/model_inheritance_regress\n./tests/sitemaps_tests\n./tests/defer_regress\n./tests/many_to_one_null\n./tests/dbshell\n./tests/fixtures\n./tests/extra_regress\n./tests/update\n./tests/model_package\n./tests/decorators\n./tests/distinct_on_fields\n./tests/queryset_pickle\n./tests/templates\n./tests/validation\n./tests/file_storage\n./tests/absolute_url_overrides\n./tests/files\n./tests/flatpages_tests\n./tests/cache\n./tests/multiple_database\n./tests/urlpatterns_reverse\n./tests/proxy_model_inheritance\n./tests/model_options\n./tests/custom_migration_operations\n./tests/many_to_many\n./tests/README.rst\n./tests/migrations\n./tests/transaction_hooks\n./tests/m2m_through\n./tests/shortcuts\n./tests/utils_tests\n./tests/view_tests\n./tests/delete\n./tests/conditional_processing\n./tests/model_indexes\n./tests/update_only_fields\n./tests/dispatch\n./tests/csrf_tests\n./tests/max_lengths\n./tests/invalid_models_tests\n./tests/dates\n./tests/version\n./tests/m2m_through_regress\n./tests/mail\n./tests/test_exceptions\n./tests/from_db_value\n./tests/empty_models\n./tests/model_meta\n./tests/wsgi\n./tests/null_queries\n./tests/test_client\n./tests/admin_autodiscover\n./tests/delete_regress\n./tests/model_fields\n./tests/import_error_package\n./tests/generic_inline_admin\n./tests/messages_tests\n./tests/model_inheritance\n./tests/force_insert_update\n./tests/logging_tests\n./tests/admin_ordering\n./tests/proxy_models\n./tests/datetimes\n./tests/urlpatterns\n./tests/admin_docs\n./tests/redirects_tests\n./tests/expressions_window\n./tests/raw_query\n./tests/backends\n./tests/select_related\n./tests/file_uploads\n./tests/model_formsets_regress\n./tests/admin_inlines\n./tests/test_client_regress\n./tests/admin_default_site\n./tests/test_sqlite.py\n./tests/db_utils\n./tests/admin_checks\n./tests/generic_relations\n./tests/select_related_regress\n./tests/.coveragerc\n./tests/requirements\n./tests/admin_views\n./tests/m2m_multiple\n./tests/migration_test_data_persistence\n./tests/field_subclassing\n./tests/managers_regress\n./tests/reverse_lookup\n./tests/get_object_or_404\n./tests/staticfiles_tests\n./tests/model_formsets\n./tests/inline_formsets\n./tests/postgres_tests\n./tests/unmanaged_models\n./tests/select_for_update\n./tests/forms_tests\n./tests/sites_tests\n./tests/custom_columns\n./tests/model_enums\n./tests/select_related_onetoone\n./tests/lookup\n./tests/user_commands\n./tests/custom_managers\n./tests/settings_tests\n./tests/m2m_recursive\n./tests/mutually_referential\n./tests/middleware_exceptions\n./tests/modeladmin\n./tests/admin_scripts\n./tests/nested_foreign_keys\n./tests/order_with_respect_to\n./tests/properties\n./tests/sessions_tests\n./tests/i18n\n./tests/m2m_and_m2o\n./package.json\n./scripts/rpm-install.sh\n./scripts/manage_translations.py\n./js_tests\n./js_tests/gis\n./js_tests/tests.html\n./js_tests/admin\n./setup.cfg\n./js_tests/qunit\n./.eslintignore\n./.git/ORIG_HEAD\n./.git/branches\n./.git/config\n./.git/description\n./.git/index\n./.git/packed-refs\n./.git/logs\n./.git/HEAD\n./.git/COMMIT_EDITMSG\n./.git/refs\n./django\n./django/conf\n./django/apps\n./django/__main__.py\n./django/templatetags\n./django/middleware\n./django/__init__.py\n./django/bin\n./django/core\n./django/__pycache__\n./django/db\n./django/template\n./django/test\n./django/dispatch\n./django/http\n./django/urls\n./django/contrib\n./django/utils\n./django/views\n./LICENSE.python\n./tox.ini\n./.eslintrc\n./Django.egg-info\n./Django.egg-info/entry_points.txt\n./Django.egg-info/requires.txt\n./Django.egg-info/PKG-INFO\n./Django.egg-info/dependency_links.txt\n./Django.egg-info/SOURCES.txt\n./AUTHORS\n./Django.egg-info/top_level.txt\n./FUNDING.yml\n./.editorconfig\n./docs\n./docs/conf.py\n./docs/topics\n./docs/howto\n./docs/man\n./docs/README\n./docs/releases\n./docs/intro\n./docs/spelling_wordlist\n./docs/internals\n./docs/index.txt\n./docs/ref\n./docs/glossary.txt\n./docs/misc\n./docs/_ext\n./docs/make.bat\n./docs/_theme\n./Gruntfile.js\n./.gitattributes\n./LICENSE\n./.tx\n./.tx/config\n./INSTALL\n./extras\n./extras/django_bash_completion\n./extras/Makefile\n./extras/README.TXT\n./.hgignore\n./MANIFEST.in",
      "applied_operators": [
        "text_perturbation"
      ]
    },
    {
      "action": "nl -ba tests/model_enums/test_model_enums.py | sed -n '1,240p'",
      "original": "nl: tests/model_enums/test_model_enums.py: No such file or directory\n",
      "perturbed": "nl: tests/model_enums/test_model_enums.py: No such file or directory",
      "applied_operators": [
        "text_perturbation"
      ]
    },
    {
      "action": "ls -la tests/model_enums",
      "original": "total 28\ndrwxrwxrwx   2 root root  4096 Sep 10 10:18 .\ndrwxrwxrwx 212 root root 12288 Sep 10 10:18 ..\n-rw-r--r--   1 root root     0 Sep 10 10:18 __init__.py\n-rw-r--r--   1 root root  9064 Sep 10 10:18 tests.py\n",
      "perturbed": "-rw-r--r--   1 root root  9064 Sep 10 10:18 tests.py\ndrwxrwxrwx 212 root root 12288 Sep 10 10:18 ..",
      "applied_operators": [
        "text_perturbation"
      ]
    },
    {
      "action": "ls -la django/db/models",
      "original": "total 372\ndrwxrwxrwx 5 root root  4096 Sep 10 10:18 .\ndrwxrwxrwx 5 root root  4096 Sep 10 10:18 ..\n-rw-r--r-- 1 root root  2339 Sep 10 10:18 __init__.py\n-rw-r--r-- 1 root root  5933 Sep 10 10:18 aggregates.py\n-rw-r--r-- 1 root root 78457 Sep 10 10:18 base.py\n-rw-r--r-- 1 root root   117 Sep 10 10:18 constants.py\n-rw-r--r-- 1 root root  4793 Sep 10 10:18 constraints.py\n-rw-r--r-- 1 root root 15667 Sep 10 10:18 deletion.py\n-rw-r--r-- 1 root root  2470 Sep 10 10:18 enums.py\n-rw-r--r-- 1 root root 48827 Sep 10 10:18 expressions.py\ndrwxrwxrwx 2 root root  4096 Sep 10 10:18 fields\ndrwxrwxrwx 2 root root  4096 Sep 10 10:18 functions\n-rw-r--r-- 1 root root  5227 Sep 10 10:18 indexes.py\n-rw-r--r-- 1 root root 21477 Sep 10 10:18 lookups.py\n-rw-r--r-- 1 root root  6767 Sep 10 10:18 manager.py\n-rw-r--r-- 1 root root 35396 Sep 10 10:18 options.py\n-rw-r--r-- 1 root root 82021 Sep 10 10:18 query.py\n-rw-r--r-- 1 root root 12178 Sep 10 10:18 query_utils.py\n-rw-r--r-- 1 root root  2160 Sep 10 10:18 signals.py\ndrwxrwxrwx 2 root root  4096 Sep 10 10:18 sql\n-rw-r--r-- 1 root root   852 Sep 10 10:18 utils.py\n",
      "perturbed": "drwxrwxrwx 5 root root  4096 Sep 10 10:18 ..\ndrwxrwxrwx 5 root root  4096 Sep 10 10:18 .\n-rw-r--r-- 1 root root  2339 Sep 10 10:18 __init__.py\n-rw-r--r-- 1 root root  5933 Sep 10 10:18 aggregates.py\n-rw-r--r-- 1 root root 78457 Sep 10 10:18 base.py\n-rw-r--r-- 1 root root   117 Sep 10 10:18 constants.py\n-rw-r--r-- 1 root root  4793 Sep 10 10:18 constraints.py\n-rw-r--r-- 1 root root 15667 Sep 10 10:18 deletion.py\n-rw-r--r-- 1 root root 48827 Sep 10 10:18 expressions.py\ndrwxrwxrwx 2 root root  4096 Sep 10 10:18 fields\n-rw-r--r-- 1 root root  5227 Sep 10 10:18 indexes.py\n-rw-r--r-- 1 root root 21477 Sep 10 10:18 lookups.py\n-rw-r--r-- 1 root root  6767 Sep 10 10:18 manager.py\n-rw-r--r-- 1 root root 82021 Sep 10 10:18 query.py\n-rw-r--r-- 1 root root 35396 Sep 10 10:18 options.py\n-rw-r--r-- 1 root root 12178 Sep 10 10:18 query_utils.py\n-rw-r--r-- 1 root root  2160 Sep 10 10:18 signals.py\n-rw-r--r-- 1 root root   852 Sep 10 10:18 utils.py\ndrwxrwxrwx 2 root root  4096 Sep 10 10:18 sql",
      "applied_operators": [
        "text_perturbation"
      ]
    },
    {
      "action": "nl -ba django/db/models/fields/__init__.py | sed -n '1,360p'",
      "original": "     1\timport collections.abc\n     2\timport copy\n     3\timport datetime\n     4\timport decimal\n     5\timport operator\n     6\timport uuid\n     7\timport warnings\n     8\tfrom base64 import b64decode, b64encode\n     9\tfrom functools import partialmethod, total_ordering\n    10\t\n    11\tfrom django import forms\n    12\tfrom django.apps import apps\n    13\tfrom django.conf import settings\n    14\tfrom django.core import checks, exceptions, validators\n    15\tfrom django.db import connection, connections, router\n    16\tfrom django.db.models.constants import LOOKUP_SEP\n    17\tfrom django.db.models.query_utils import DeferredAttribute, RegisterLookupMixin\n    18\tfrom django.utils import timezone\n    19\tfrom django.utils.datastructures import DictWrapper\n    20\tfrom django.utils.dateparse import (\n    21\t    parse_date, parse_datetime, parse_duration, parse_time,\n    22\t)\n    23\tfrom django.utils.duration import duration_microseconds, duration_string\n    24\tfrom django.utils.functional import Promise, cached_property\n    25\tfrom django.utils.ipv6 import clean_ipv6_address\n    26\tfrom django.utils.itercompat import is_iterable\n    27\tfrom django.utils.text import capfirst\n    28\tfrom django.utils.translation import gettext_lazy as _\n    29\t\n    30\t__all__ = [\n    31\t    'AutoField', 'BLANK_CHOICE_DASH', 'BigAutoField', 'BigIntegerField',\n    32\t    'BinaryField', 'BooleanField', 'CharField', 'CommaSeparatedIntegerField',\n    33\t    'DateField', 'DateTimeField', 'DecimalField', 'DurationField',\n    34\t    'EmailField', 'Empty', 'Field', 'FilePathField', 'FloatField',\n    35\t    'GenericIPAddressField', 'IPAddressField', 'IntegerField', 'NOT_PROVIDED',\n    36\t    'NullBooleanField', 'PositiveIntegerField', 'PositiveSmallIntegerField',\n    37\t    'SlugField', 'SmallAutoField', 'SmallIntegerField', 'TextField',\n    38\t    'TimeField', 'URLField', 'UUIDField',\n    39\t]\n    40\t\n    41\t\n    42\tclass Empty:\n    43\t    pass\n    44\t\n    45\t\n    46\tclass NOT_PROVIDED:\n    47\t    pass\n    48\t\n    49\t\n    50\t# The values to use for \"blank\" in SelectFields. Will be appended to the start\n    51\t# of most \"choices\" lists.\n    52\tBLANK_CHOICE_DASH = [(\"\", \"---------\")]\n    53\t\n    54\t\n    55\tdef _load_field(app_label, model_name, field_name):\n    56\t    return apps.get_model(app_label, model_name)._meta.get_field(field_name)\n    57\t\n    58\t\n    59\t# A guide to Field parameters:\n    60\t#\n    61\t#   * name:      The name of the field specified in the model.\n    62\t#   * attname:   The attribute to use on the model object. This is the same as\n    63\t#                \"name\", except in the case of ForeignKeys, where \"_id\" is\n    64\t#                appended.\n    65\t#   * db_column: The db_column specified in the model (or None).\n    66\t#   * column:    The database column for this field. This is the same as\n    67\t#                \"attname\", except if db_column is specified.\n    68\t#\n    69\t# Code that introspects values, or does other dynamic things, should use\n    70\t# attname. For example, this gets the primary key value of object \"obj\":\n    71\t#\n    72\t#     getattr(obj, opts.pk.attname)\n    73\t\n    74\tdef _empty(of_cls):\n    75\t    new = Empty()\n    76\t    new.__class__ = of_cls\n    77\t    return new\n    78\t\n    79\t\n    80\tdef return_None():\n    81\t    return None\n    82\t\n    83\t\n    84\t@total_ordering\n    85\tclass Field(RegisterLookupMixin):\n    86\t    \"\"\"Base class for all field types\"\"\"\n    87\t\n    88\t    # Designates whether empty strings fundamentally are allowed at the\n    89\t    # database level.\n    90\t    empty_strings_allowed = True\n    91\t    empty_values = list(validators.EMPTY_VALUES)\n    92\t\n    93\t    # These track each time a Field instance is created. Used to retain order.\n    94\t    # The auto_creation_counter is used for fields that Django implicitly\n    95\t    # creates, creation_counter is used for all user-specified fields.\n    96\t    creation_counter = 0\n    97\t    auto_creation_counter = -1\n    98\t    default_validators = []  # Default set of validators\n    99\t    default_error_messages = {\n   100\t        'invalid_choice': _('Value %(value)r is not a valid choice.'),\n   101\t        'null': _('This field cannot be null.'),\n   102\t        'blank': _('This field cannot be blank.'),\n   103\t        'unique': _('%(model_name)s with this %(field_label)s '\n   104\t                    'already exists.'),\n   105\t        # Translators: The 'lookup_type' is one of 'date', 'year' or 'month'.\n   106\t        # Eg: \"Title must be unique for pub_date year\"\n   107\t        'unique_for_date': _(\"%(field_label)s must be unique for \"\n   108\t                             \"%(date_field_label)s %(lookup_type)s.\"),\n   109\t    }\n   110\t    system_check_deprecated_details = None\n   111\t    system_check_removed_details = None\n   112\t\n   113\t    # Field flags\n   114\t    hidden = False\n   115\t\n   116\t    many_to_many = None\n   117\t    many_to_one = None\n   118\t    one_to_many = None\n   119\t    one_to_one = None\n   120\t    related_model = None\n   121\t\n   122\t    descriptor_class = DeferredAttribute\n   123\t\n   124\t    # Generic field type description, usually overridden by subclasses\n   125\t    def _description(self):\n   126\t        return _('Field of type: %(field_type)s') % {\n   127\t            'field_type': self.__class__.__name__\n   128\t        }\n   129\t    description = property(_description)\n   130\t\n   131\t    def __init__(self, verbose_name=None, name=None, primary_key=False,\n   132\t                 max_length=None, unique=False, blank=False, null=False,\n   133\t                 db_index=False, rel=None, default=NOT_PROVIDED, editable=True,\n   134\t                 serialize=True, unique_for_date=None, unique_for_month=None,\n   135\t                 unique_for_year=None, choices=None, help_text='', db_column=None,\n   136\t                 db_tablespace=None, auto_created=False, validators=(),\n   137\t                 error_messages=None):\n   138\t        self.name = name\n   139\t        self.verbose_name = verbose_name  # May be set by set_attributes_from_name\n   140\t        self._verbose_name = verbose_name  # Store original for deconstruction\n   141\t        self.primary_key = primary_key\n   142\t        self.max_length, self._unique = max_length, unique\n   143\t        self.blank, self.null = blank, null\n   144\t        self.remote_field = rel\n   145\t        self.is_relation = self.remote_field is not None\n   146\t        self.default = default\n   147\t        self.editable = editable\n   148\t        self.serialize = serialize\n   149\t        self.unique_for_date = unique_for_date\n   150\t        self.unique_for_month = unique_for_month\n   151\t        self.unique_for_year = unique_for_year\n   152\t        if isinstance(choices, collections.abc.Iterator):\n   153\t            choices = list(choices)\n   154\t        self.choices = choices\n   155\t        self.help_text = help_text\n   156\t        self.db_index = db_index\n   157\t        self.db_column = db_column\n   158\t        self._db_tablespace = db_tablespace\n   159\t        self.auto_created = auto_created\n   160\t\n   161\t        # Adjust the appropriate creation counter, and save our local copy.\n   162\t        if auto_created:\n   163\t            self.creation_counter = Field.auto_creation_counter\n   164\t            Field.auto_creation_counter -= 1\n   165\t        else:\n   166\t            self.creation_counter = Field.creation_counter\n   167\t            Field.creation_counter += 1\n   168\t\n   169\t        self._validators = list(validators)  # Store for deconstruction later\n   170\t\n   171\t        messages = {}\n   172\t        for c in reversed(self.__class__.__mro__):\n   173\t            messages.update(getattr(c, 'default_error_messages', {}))\n   174\t        messages.update(error_messages or {})\n   175\t        self._error_messages = error_messages  # Store for deconstruction later\n   176\t        self.error_messages = messages\n   177\t\n   178\t    def __str__(self):\n   179\t        \"\"\"\n   180\t        Return \"app_label.model_label.field_name\" for fields attached to\n   181\t        models.\n   182\t        \"\"\"\n   183\t        if not hasattr(self, 'model'):\n   184\t            return super().__str__()\n   185\t        model = self.model\n   186\t        app = model._meta.app_label\n   187\t        return '%s.%s.%s' % (app, model._meta.object_name, self.name)\n   188\t\n   189\t    def __repr__(self):\n   190\t        \"\"\"Display the module, class, and name of the field.\"\"\"\n   191\t        path = '%s.%s' % (self.__class__.__module__, self.__class__.__qualname__)\n   192\t        name = getattr(self, 'name', None)\n   193\t        if name is not None:\n   194\t            return '<%s: %s>' % (path, name)\n   195\t        return '<%s>' % path\n   196\t\n   197\t    def check(self, **kwargs):\n   198\t        return [\n   199\t            *self._check_field_name(),\n   200\t            *self._check_choices(),\n   201\t            *self._check_db_index(),\n   202\t            *self._check_null_allowed_for_primary_keys(),\n   203\t            *self._check_backend_specific_checks(**kwargs),\n   204\t            *self._check_validators(),\n   205\t            *self._check_deprecation_details(),\n   206\t        ]\n   207\t\n   208\t    def _check_field_name(self):\n   209\t        \"\"\"\n   210\t        Check if field name is valid, i.e. 1) does not end with an\n   211\t        underscore, 2) does not contain \"__\" and 3) is not \"pk\".\n   212\t        \"\"\"\n   213\t        if self.name.endswith('_'):\n   214\t            return [\n   215\t                checks.Error(\n   216\t                    'Field names must not end with an underscore.',\n   217\t                    obj=self,\n   218\t                    id='fields.E001',\n   219\t                )\n   220\t            ]\n   221\t        elif LOOKUP_SEP in self.name:\n   222\t            return [\n   223\t                checks.Error(\n   224\t                    'Field names must not contain \"%s\".' % (LOOKUP_SEP,),\n   225\t                    obj=self,\n   226\t                    id='fields.E002',\n   227\t                )\n   228\t            ]\n   229\t        elif self.name == 'pk':\n   230\t            return [\n   231\t                checks.Error(\n   232\t                    \"'pk' is a reserved word that cannot be used as a field name.\",\n   233\t                    obj=self,\n   234\t                    id='fields.E003',\n   235\t                )\n   236\t            ]\n   237\t        else:\n   238\t            return []\n   239\t\n   240\t    def _check_choices(self):\n   241\t        if not self.choices:\n   242\t            return []\n   243\t\n   244\t        def is_value(value, accept_promise=True):\n   245\t            return isinstance(value, (str, Promise) if accept_promise else str) or not is_iterable(value)\n   246\t\n   247\t        if is_value(self.choices, accept_promise=False):\n   248\t            return [\n   249\t                checks.Error(\n   250\t                    \"'choices' must be an iterable (e.g., a list or tuple).\",\n   251\t                    obj=self,\n   252\t                    id='fields.E004',\n   253\t                )\n   254\t            ]\n   255\t\n   256\t        choice_max_length = 0\n   257\t        # Expect [group_name, [value, display]]\n   258\t        for choices_group in self.choices:\n   259\t            try:\n   260\t                group_name, group_choices = choices_group\n   261\t            except (TypeError, ValueError):\n   262\t                # Containing non-pairs\n   263\t                break\n   264\t            try:\n   265\t                if not all(\n   266\t                    is_value(value) and is_value(human_name)\n   267\t                    for value, human_name in group_choices\n   268\t                ):\n   269\t                    break\n   270\t                if self.max_length is not None and group_choices:\n   271\t                    choice_max_length = max(\n   272\t                        choice_max_length,\n   273\t                        *(len(value) for value, _ in group_choices if isinstance(value, str)),\n   274\t                    )\n   275\t            except (TypeError, ValueError):\n   276\t                # No groups, choices in the form [value, display]\n   277\t                value, human_name = group_name, group_choices\n   278\t                if not is_value(value) or not is_value(human_name):\n   279\t                    break\n   280\t                if self.max_length is not None and isinstance(value, str):\n   281\t                    choice_max_length = max(choice_max_length, len(value))\n   282\t\n   283\t            # Special case: choices=['ab']\n   284\t            if isinstance(choices_group, str):\n   285\t                break\n   286\t        else:\n   287\t            if self.max_length is not None and choice_max_length > self.max_length:\n   288\t                return [\n   289\t                    checks.Error(\n   290\t                        \"'max_length' is too small to fit the longest value \"\n   291\t                        \"in 'choices' (%d characters).\" % choice_max_length,\n   292\t                        obj=self,\n   293\t                        id='fields.E009',\n   294\t                    ),\n   295\t                ]\n   296\t            return []\n   297\t\n   298\t        return [\n   299\t            checks.Error(\n   300\t                \"'choices' must be an iterable containing \"\n   301\t                \"(actual value, human readable name) tuples.\",\n   302\t                obj=self,\n   303\t                id='fields.E005',\n   304\t            )\n   305\t        ]\n   306\t\n   307\t    def _check_db_index(self):\n   308\t        if self.db_index not in (None, True, False):\n   309\t            return [\n   310\t                checks.Error(\n   311\t                    \"'db_index' must be None, True or False.\",\n   312\t                    obj=self,\n   313\t                    id='fields.E006',\n   314\t                )\n   315\t            ]\n   316\t        else:\n   317\t            return []\n   318\t\n   319\t    def _check_null_allowed_for_primary_keys(self):\n   320\t        if (self.primary_key and self.null and\n   321\t                not connection.features.interprets_empty_strings_as_nulls):\n   322\t            # We cannot reliably check this for backends like Oracle which\n   323\t            # consider NULL and '' to be equal (and thus set up\n   324\t            # character-based fields a little differently).\n   325\t            return [\n   326\t                checks.Error(\n   327\t                    'Primary keys must not have null=True.',\n   328\t                    hint=('Set null=False on the field, or '\n   329\t                          'remove primary_key=True argument.'),\n   330\t                    obj=self,\n   331\t                    id='fields.E007',\n   332\t                )\n   333\t            ]\n   334\t        else:\n   335\t            return []\n   336\t\n   337\t    def _check_backend_specific_checks(self, **kwargs):\n   338\t        app_label = self.model._meta.app_label\n   339\t        for db in connections:\n   340\t            if router.allow_migrate(db, app_label, model_name=self.model._meta.model_name):\n   341\t                return connections[db].validation.check_field(self, **kwargs)\n   342\t        return []\n   343\t\n   344\t    def _check_validators(self):\n   345\t        errors = []\n   346\t        for i, validator in enumerate(self.validators):\n   347\t            if not callable(validator):\n   348\t                errors.append(\n   349\t                    checks.Error(\n   350\t                        \"All 'validators' must be callable.\",\n   351\t                        hint=(\n   352\t                            \"validators[{i}] ({repr}) isn't a function or \"\n   353\t                            \"instance of a validator class.\".format(\n   354\t                                i=i, repr=repr(validator),\n   355\t                            )\n   356\t                        ),\n   357\t                        obj=self,\n   358\t                        id='fields.E008',\n   359\t                    )\n   360\t                )\n",
      "perturbed": "     1\timport collections.abc\n     2\timport copy\n     4\timport decimal\n     5\timport operator\n     7\timport warnings\n     6\timport uuid\n     8\tfrom base64 import b64decode, b64encode\n     9\tfrom functools import partialmethod, total_ordering\n    11\tfrom django import forms\n    10\t\n    12\tfrom django.apps import apps\n    13\tfrom django.conf import settings\n    15\tfrom django.db import connection, connections, router\n    14\tfrom django.core import checks, exceptions, validators\n    17\tfrom django.db.models.query_utils import DeferredAttribute, RegisterLookupMixin\n    16\tfrom django.db.models.constants import LOOKUP_SEP\n    18\tfrom django.utils import timezone\n    19\tfrom django.utils.datastructures import DictWrapper\n    20\tfrom django.utils.dateparse import (\n    21\t    parse_date, parse_datetime, parse_duration, parse_time,\n    22\t)\n    23\tfrom django.utils.duration import duration_microseconds, duration_string\n    25\tfrom django.utils.ipv6 import clean_ipv6_address\n    26\tfrom django.utils.itercompat import is_iterable\n    27\tfrom django.utils.text import capfirst\n    28\tfrom django.utils.translation import gettext_lazy as _\n    29\t\n    31\t    'AutoField', 'BLANK_CHOICE_DASH', 'BigAutoField', 'BigIntegerField',\n    30\t__all__ = [\n    32\t    'BinaryField', 'BooleanField', 'CharField', 'CommaSeparatedIntegerField',\n    33\t    'DateField', 'DateTimeField', 'DecimalField', 'DurationField',\n    34\t    'EmailField', 'Empty', 'Field', 'FilePathField', 'FloatField',\n    35\t    'GenericIPAddressField', 'IPAddressField', 'IntegerField', 'NOT_PROVIDED',\n    38\t    'TimeField', 'URLField', 'UUIDField',\n    39\t]\n    40\t\n[warning] unexpected output\n    42\tclass Empty:\n    41\t\n    43\t    pass\n    45\t\n    44\t\n    46\tclass NOT_PROVIDED:\n    47\t    pass\n    49\t\n    50\t# The values to use for \"blank\" in SelectFields. Will be appended to the start\n    51\t# of most \"choices\" lists.\n    52\tBLANK_CHOICE_DASH = [(\"\", \"---------\")]\n    53\t\n    54\t\n    55\tdef _load_field(app_label, model_name, field_name):\n    56\t    return apps.get_model(app_label, model_name)._meta.get_field(field_name)\n    57\t\n    61\t#   * name:      The name of the field specified in the model.\n    58\t\n    62\t#   * attname:   The attribute to use on the model object. This is the same as\n    64\t#                appended.\n    67\t#                \"attname\", except if db_column is specified.\n    65\t#   * db_column: The db_column specified in the model (or None).\n    68\t#\n    69\t# Code that introspects values, or does other dynamic things, should use\n    70\t# attname. For example, this gets the primary key value of object \"obj\":\n    72\t#     getattr(obj, opts.pk.attname)\n    73\t\n    74\tdef _empty(of_cls):\n    77\t    return new\n    80\tdef return_None():\n    81\t    return None\n    82\t\n    84\t@total_ordering\n    86\t    \"\"\"Base class for all field types\"\"\"\n    85\tclass Field(RegisterLookupMixin):\n    87\t\n    88\t    # Designates whether empty strings fundamentally are allowed at the\n    89\t    # database level.\n    90\t    empty_strings_allowed = True\n    92\t\n    94\t    # The auto_creation_counter is used for fields that Django implicitly\n    93\t    # These track each time a Field instance is created. Used to retain order.\n    95\t    # creates, creation_counter is used for all user-specified fields.\n    96\t    creation_counter = 0\n    97\t    auto_creation_counter = -1\n    99\t    default_error_messages = {\n   100\t        'invalid_choice': _('Value %(value)r is not a valid choice.'),\n   101\t        'null': _('This field cannot be null.'),\n   102\t        'blank': _('This field cannot be blank.'),\n   103\t        'unique': _('%(model_name)s with this %(field_label)s '\n   104\t                    'already exists.'),\n   105\t        # Translators: The 'lookup_type' is one of 'date', 'year' or 'month'.\n   106\t        # Eg: \"Title must be unique for pub_date year\"\n   108\t                             \"%(date_field_label)s %(lookup_type)s.\"),\n   107\t        'unique_for_date': _(\"%(field_label)s must be unique for \"\n   109\t    }\n   111\t    system_check_removed_details = None\n   112\t\n   114\t    hidden = False\n   115\t\n   116\t    many_to_many = None\n   117\t    many_to_one = None\n   120\t    related_model = None\n   119\t    one_to_one = None\n   121\t\n   122\t    descriptor_class = DeferredAttribute\n   123\t\n   124\t    # Generic field type description, usually overridden by subclasses\n   126\t        return _('Field of type: %(field_type)s') % {\n   127\t            'field_type': self.__class__.__name__\n   128\t        }\n   129\t    description = property(_description)\n   130\t\n   132\t                 max_length=None, unique=False, blank=False, null=False,\n   131\t    def __init__(self, verbose_name=None, name=None, primary_key=False,\n   133\t                 db_index=False, rel=None, default=NOT_PROVIDED, editable=True,\n   134\t                 serialize=True, unique_for_date=None, unique_for_month=None,\n   135\t                 unique_for_year=None, choices=None, help_text='', db_column=None,\n   136\t                 db_tablespace=None, auto_created=False, validators=(),\n   137\t                 error_messages=None):\n   138\t        self.name = name\n   139\t        self.verbose_name = verbose_name  # May be set by set_attributes_from_name\n   141\t        self.primary_key = primary_key\n   140\t        self._verbose_name = verbose_name  # Store original for deconstruction\n   145\t        self.is_relation = self.remote_field is not None\n   143\t        self.blank, self.null = blank, null\n   146\t        self.default = default\n   149\t        self.unique_for_date = unique_for_date\n   151\t        self.unique_for_year = unique_for_year\n   153\t            choices = list(choices)\n   152\t        if isinstance(choices, collections.abc.Iterator):\n   154\t        self.choices = choices\n   155\t        self.help_text = help_text\n   156\t        self.db_index = db_index\n   157\t        self.db_column = db_column\n   158\t        self._db_tablespace = db_tablespace\n   159\t        self.auto_created = auto_created\n   160\t\n   161\t        # Adjust the appropriate creation counter, and save our local copy.\n   162\t        if auto_created:\n   164\t            Field.auto_creation_counter -= 1\n   163\t            self.creation_counter = Field.auto_creation_counter\n   165\t        else:\n   166\t            self.creation_counter = Field.creation_counter\n   167\t            Field.creation_counter += 1\n   169\t        self._validators = list(validators)  # Store for deconstruction later\n   170\t\n   173\t            messages.update(getattr(c, 'default_error_messages', {}))\n   172\t        for c in reversed(self.__class__.__mro__):\n   174\t        messages.update(error_messages or {})\n   175\t        self._error_messages = error_messages  # Store for deconstruction later\n   177\t\n   178\t    def __str__(self):\n   179\t        \"\"\"\n   180\t        Return \"app_label.model_label.field_name\" for fields attached to\n   181\t        models.\n   182\t        \"\"\"\n   186\t        app = model._meta.app_label\n   188\t\n   187\t        return '%s.%s.%s' % (app, model._meta.object_name, self.name)\n   189\t    def __repr__(self):\n   190\t        \"\"\"Display the module, class, and name of the field.\"\"\"\n   191\t        path = '%s.%s' % (self.__class__.__module__, self.__class__.__qualname__)\n   192\t        name = getattr(self, 'name', None)\n   194\t            return '<%s: %s>' % (path, name)\n   193\t        if name is not None:\n   195\t        return '<%s>' % path\n   196\t\n   197\t    def check(self, **kwargs):\n   201\t            *self._check_db_index(),\n   198\t        return [\n   202\t            *self._check_null_allowed_for_primary_keys(),\n   206\t        ]\n   204\t            *self._check_validators(),\n   208\t    def _check_field_name(self):\n   209\t        \"\"\"\n   210\t        Check if field name is valid, i.e. 1) does not end with an\n   212\t        \"\"\"\n   211\t        underscore, 2) does not contain \"__\" and 3) is not \"pk\".\n   213\t        if self.name.endswith('_'):\n   215\t                checks.Error(\n   214\t            return [\n   216\t                    'Field names must not end with an underscore.',\n   217\t                    obj=self,\n   218\t                    id='fields.E001',\n   219\t                )\n   220\t            ]\n   221\t        elif LOOKUP_SEP in self.name:\n   222\t            return [\n   223\t                checks.Error(\n   224\t                    'Field names must not contain \"%s\".' % (LOOKUP_SEP,),\n   225\t                    obj=self,\n   226\t                    id='fields.E002',\n   227\t                )\n   229\t        elif self.name == 'pk':\n   228\t            ]\n   230\t            return [\n   233\t                    obj=self,\n   234\t                    id='fields.E003',\n   235\t                )\n   237\t        else:\n   236\t            ]\n   239\t\n   240\t    def _check_choices(self):\n   241\t        if not self.choices:\n   242\t            return []\n   243\t\n   246\t\n   245\t            return isinstance(value, (str, Promise) if accept_promise else str) or not is_iterable(value)\n   247\t        if is_value(self.choices, accept_promise=False):\n   250\t                    \"'choices' must be an iterable (e.g., a list or tuple).\",\n   249\t                checks.Error(\n   251\t                    obj=self,\n   252\t                    id='fields.E004',\n   253\t                )\n   254\t            ]\n   255\t\n   256\t        choice_max_length = 0\n   257\t        # Expect [group_name, [value, display]]\n   259\t            try:\n   258\t        for choices_group in self.choices:\n   260\t                group_name, group_choices = choices_group\n   261\t            except (TypeError, ValueError):\n   262\t                # Containing non-pairs\n   265\t                if not all(\n   263\t                break\n   266\t                    is_value(value) and is_value(human_name)\n   268\t                ):\n   267\t                    for value, human_name in group_choices\n   269\t                    break\n   270\t                if self.max_length is not None and group_choices:\n   271\t                    choice_max_length = max(\n   272\t                        choice_max_length,\n   273\t                        *(len(value) for value, _ in group_choices if isinstance(value, str)),\n   274\t                    )\n   275\t            except (TypeError, ValueError):\n   277\t                value, human_name = group_name, group_choices\n   276\t                # No groups, choices in the form [value, display]\n   279\t                    break\n   278\t                if not is_value(value) or not is_value(human_name):\n   283\t            # Special case: choices=['ab']\n   280\t                if self.max_length is not None and isinstance(value, str):\n   284\t            if isinstance(choices_group, str):\n   285\t                break\n   288\t                return [\n   287\t            if self.max_length is not None and choice_max_length > self.max_length:\n   289\t                    checks.Error(\n   293\t                        id='fields.E009',\n   295\t                ]\n   296\t            return []\n   297\t\n   298\t        return [\n   299\t            checks.Error(\n   300\t                \"'choices' must be an iterable containing \"\n   304\t            )\n   302\t                obj=self,\n   307\t    def _check_db_index(self):\n   306\t\n   309\t            return [\n   308\t        if self.db_index not in (None, True, False):\n   310\t                checks.Error(\n   312\t                    obj=self,\n   313\t                    id='fields.E006',\n   315\t            ]\n   316\t        else:\n   317\t            return []\n   318\t\n   319\t    def _check_null_allowed_for_primary_keys(self):\n   320\t        if (self.primary_key and self.null and\n   322\t            # We cannot reliably check this for backends like Oracle which\n   323\t            # consider NULL and '' to be equal (and thus set up\n   324\t            # character-based fields a little differently).\n   325\t            return [\n   328\t                    hint=('Set null=False on the field, or '\n   329\t                          'remove primary_key=True argument.'),\n   330\t                    obj=self,\n   332\t                )\n   333\t            ]\n   334\t        else:\n   336\t\n   335\t            return []\n   337\t    def _check_backend_specific_checks(self, **kwargs):\n   338\t        app_label = self.model._meta.app_label\n   339\t        for db in connections:\n   340\t            if router.allow_migrate(db, app_label, model_name=self.model._meta.model_name):\n   342\t        return []\n   341\t                return connections[db].validation.check_field(self, **kwargs)\n   343\t\n   344\t    def _check_validators(self):\n   346\t        for i, validator in enumerate(self.validators):\n   345\t        errors = []\n   347\t            if not callable(validator):\n   348\t                errors.append(\n   349\t                    checks.Error(\n   350\t                        \"All 'validators' must be callable.\",\n   351\t                        hint=(\n   352\t                            \"validators[{i}] ({repr}) isn't a function or \"\n   353\t                            \"instance of a validator class.\".format(\n   354\t                                i=i, repr=repr(validator),\n   355\t                            )\n   357\t                        obj=self,\n   356\t                        ),\n   360\t                )",
      "applied_operators": [
        "text_perturbation"
      ]
    },
    {
      "action": "nl -ba django/db/models/query_utils.py | sed -n '1,240p'",
      "original": "     1\t\"\"\"\n     2\tVarious data structures used in query construction.\n     3\t\n     4\tFactored out from django.db.models.query to avoid making the main module very\n     5\tlarge and/or so that they can be used by other modules without getting into\n     6\tcircular import difficulties.\n     7\t\"\"\"\n     8\timport copy\n     9\timport functools\n    10\timport inspect\n    11\tfrom collections import namedtuple\n    12\t\n    13\tfrom django.db.models.constants import LOOKUP_SEP\n    14\tfrom django.utils import tree\n    15\t\n    16\t# PathInfo is used when converting lookups (fk__somecol). The contents\n    17\t# describe the relation in Model terms (model Options and Fields for both\n    18\t# sides of the relation. The join_field is the field backing the relation.\n    19\tPathInfo = namedtuple('PathInfo', 'from_opts to_opts target_fields join_field m2m direct filtered_relation')\n    20\t\n    21\t\n    22\tclass InvalidQuery(Exception):\n    23\t    \"\"\"The query passed to raw() isn't a safe query to use with raw().\"\"\"\n    24\t    pass\n    25\t\n    26\t\n    27\tdef subclasses(cls):\n    28\t    yield cls\n    29\t    for subclass in cls.__subclasses__():\n    30\t        yield from subclasses(subclass)\n    31\t\n    32\t\n    33\tclass QueryWrapper:\n    34\t    \"\"\"\n    35\t    A type that indicates the contents are an SQL fragment and the associate\n    36\t    parameters. Can be used to pass opaque data to a where-clause, for example.\n    37\t    \"\"\"\n    38\t    contains_aggregate = False\n    39\t\n    40\t    def __init__(self, sql, params):\n    41\t        self.data = sql, list(params)\n    42\t\n    43\t    def as_sql(self, compiler=None, connection=None):\n    44\t        return self.data\n    45\t\n    46\t\n    47\tclass Q(tree.Node):\n    48\t    \"\"\"\n    49\t    Encapsulate filters as objects that can then be combined logically (using\n    50\t    `&` and `|`).\n    51\t    \"\"\"\n    52\t    # Connection types\n    53\t    AND = 'AND'\n    54\t    OR = 'OR'\n    55\t    default = AND\n    56\t    conditional = True\n    57\t\n    58\t    def __init__(self, *args, _connector=None, _negated=False, **kwargs):\n    59\t        super().__init__(children=[*args, *sorted(kwargs.items())], connector=_connector, negated=_negated)\n    60\t\n    61\t    def _combine(self, other, conn):\n    62\t        if not isinstance(other, Q):\n    63\t            raise TypeError(other)\n    64\t\n    65\t        # If the other Q() is empty, ignore it and just use `self`.\n    66\t        if not other:\n    67\t            return copy.deepcopy(self)\n    68\t        # Or if this Q is empty, ignore it and just use `other`.\n    69\t        elif not self:\n    70\t            return copy.deepcopy(other)\n    71\t\n    72\t        obj = type(self)()\n    73\t        obj.connector = conn\n    74\t        obj.add(self, conn)\n    75\t        obj.add(other, conn)\n    76\t        return obj\n    77\t\n    78\t    def __or__(self, other):\n    79\t        return self._combine(other, self.OR)\n    80\t\n    81\t    def __and__(self, other):\n    82\t        return self._combine(other, self.AND)\n    83\t\n    84\t    def __invert__(self):\n    85\t        obj = type(self)()\n    86\t        obj.add(self, self.AND)\n    87\t        obj.negate()\n    88\t        return obj\n    89\t\n    90\t    def resolve_expression(self, query=None, allow_joins=True, reuse=None, summarize=False, for_save=False):\n    91\t        # We must promote any new joins to left outer joins so that when Q is\n    92\t        # used as an expression, rows aren't filtered due to joins.\n    93\t        clause, joins = query._add_q(self, reuse, allow_joins=allow_joins, split_subq=False)\n    94\t        query.promote_joins(joins)\n    95\t        return clause\n    96\t\n    97\t    def deconstruct(self):\n    98\t        path = '%s.%s' % (self.__class__.__module__, self.__class__.__name__)\n    99\t        if path.startswith('django.db.models.query_utils'):\n   100\t            path = path.replace('django.db.models.query_utils', 'django.db.models')\n   101\t        args, kwargs = (), {}\n   102\t        if len(self.children) == 1 and not isinstance(self.children[0], Q):\n   103\t            child = self.children[0]\n   104\t            kwargs = {child[0]: child[1]}\n   105\t        else:\n   106\t            args = tuple(self.children)\n   107\t            if self.connector != self.default:\n   108\t                kwargs = {'_connector': self.connector}\n   109\t        if self.negated:\n   110\t            kwargs['_negated'] = True\n   111\t        return path, args, kwargs\n   112\t\n   113\t\n   114\tclass DeferredAttribute:\n   115\t    \"\"\"\n   116\t    A wrapper for a deferred-loading field. When the value is read from this\n   117\t    object the first time, the query is executed.\n   118\t    \"\"\"\n   119\t    def __init__(self, field):\n   120\t        self.field = field\n   121\t\n   122\t    def __get__(self, instance, cls=None):\n   123\t        \"\"\"\n   124\t        Retrieve and caches the value from the datastore on the first lookup.\n   125\t        Return the cached value.\n   126\t        \"\"\"\n   127\t        if instance is None:\n   128\t            return self\n   129\t        data = instance.__dict__\n   130\t        field_name = self.field.attname\n   131\t        if data.get(field_name, self) is self:\n   132\t            # Let's see if the field is part of the parent chain. If so we\n   133\t            # might be able to reuse the already loaded value. Refs #18343.\n   134\t            val = self._check_parent_chain(instance)\n   135\t            if val is None:\n   136\t                instance.refresh_from_db(fields=[field_name])\n   137\t                val = getattr(instance, field_name)\n   138\t            data[field_name] = val\n   139\t        return data[field_name]\n   140\t\n   141\t    def _check_parent_chain(self, instance):\n   142\t        \"\"\"\n   143\t        Check if the field value can be fetched from a parent field already\n   144\t        loaded in the instance. This can be done if the to-be fetched\n   145\t        field is a primary key field.\n   146\t        \"\"\"\n   147\t        opts = instance._meta\n   148\t        link_field = opts.get_ancestor_link(self.field.model)\n   149\t        if self.field.primary_key and self.field != link_field:\n   150\t            return getattr(instance, link_field.attname)\n   151\t        return None\n   152\t\n   153\t\n   154\tclass RegisterLookupMixin:\n   155\t\n   156\t    @classmethod\n   157\t    def _get_lookup(cls, lookup_name):\n   158\t        return cls.get_lookups().get(lookup_name, None)\n   159\t\n   160\t    @classmethod\n   161\t    @functools.lru_cache(maxsize=None)\n   162\t    def get_lookups(cls):\n   163\t        class_lookups = [parent.__dict__.get('class_lookups', {}) for parent in inspect.getmro(cls)]\n   164\t        return cls.merge_dicts(class_lookups)\n   165\t\n   166\t    def get_lookup(self, lookup_name):\n   167\t        from django.db.models.lookups import Lookup\n   168\t        found = self._get_lookup(lookup_name)\n   169\t        if found is None and hasattr(self, 'output_field'):\n   170\t            return self.output_field.get_lookup(lookup_name)\n   171\t        if found is not None and not issubclass(found, Lookup):\n   172\t            return None\n   173\t        return found\n   174\t\n   175\t    def get_transform(self, lookup_name):\n   176\t        from django.db.models.lookups import Transform\n   177\t        found = self._get_lookup(lookup_name)\n   178\t        if found is None and hasattr(self, 'output_field'):\n   179\t            return self.output_field.get_transform(lookup_name)\n   180\t        if found is not None and not issubclass(found, Transform):\n   181\t            return None\n   182\t        return found\n   183\t\n   184\t    @staticmethod\n   185\t    def merge_dicts(dicts):\n   186\t        \"\"\"\n   187\t        Merge dicts in reverse to preference the order of the original list. e.g.,\n   188\t        merge_dicts([a, b]) will preference the keys in 'a' over those in 'b'.\n   189\t        \"\"\"\n   190\t        merged = {}\n   191\t        for d in reversed(dicts):\n   192\t            merged.update(d)\n   193\t        return merged\n   194\t\n   195\t    @classmethod\n   196\t    def _clear_cached_lookups(cls):\n   197\t        for subclass in subclasses(cls):\n   198\t            subclass.get_lookups.cache_clear()\n   199\t\n   200\t    @classmethod\n   201\t    def register_lookup(cls, lookup, lookup_name=None):\n   202\t        if lookup_name is None:\n   203\t            lookup_name = lookup.lookup_name\n   204\t        if 'class_lookups' not in cls.__dict__:\n   205\t            cls.class_lookups = {}\n   206\t        cls.class_lookups[lookup_name] = lookup\n   207\t        cls._clear_cached_lookups()\n   208\t        return lookup\n   209\t\n   210\t    @classmethod\n   211\t    def _unregister_lookup(cls, lookup, lookup_name=None):\n   212\t        \"\"\"\n   213\t        Remove given lookup from cls lookups. For use in tests only as it's\n   214\t        not thread-safe.\n   215\t        \"\"\"\n   216\t        if lookup_name is None:\n   217\t            lookup_name = lookup.lookup_name\n   218\t        del cls.class_lookups[lookup_name]\n   219\t\n   220\t\n   221\tdef select_related_descend(field, restricted, requested, load_fields, reverse=False):\n   222\t    \"\"\"\n   223\t    Return True if this field should be used to descend deeper for\n   224\t    select_related() purposes. Used by both the query construction code\n   225\t    (sql.query.fill_related_selections()) and the model instance creation code\n   226\t    (query.get_klass_info()).\n   227\t\n   228\t    Arguments:\n   229\t     * field - the field to be checked\n   230\t     * restricted - a boolean field, indicating if the field list has been\n   231\t       manually restricted using a requested clause)\n   232\t     * requested - The select_related() dictionary.\n   233\t     * load_fields - the set of fields to be loaded on this model\n   234\t     * reverse - boolean, True if we are checking a reverse select related\n   235\t    \"\"\"\n   236\t    if not field.remote_field:\n   237\t        return False\n   238\t    if field.remote_field.parent_link and not reverse:\n   239\t        return False\n   240\t    if restricted:\n",
      "perturbed": "     2\tVarious data structures used in query construction.\n     3\t\n     4\tFactored out from django.db.models.query to avoid making the main module very\n     5\tlarge and/or so that they can be used by other modules without getting into\n     6\tcircular import difficulties.\n     7\t\"\"\"\n    10\timport inspect\n     9\timport functools\n    11\tfrom collections import namedtuple\n    13\tfrom django.db.models.constants import LOOKUP_SEP\n    12\t\n    14\tfrom django.utils import tree\n    15\t\n    18\t# sides of the relation. The join_field is the field backing the relation.\n    19\tPathInfo = namedtuple('PathInfo', 'from_opts to_opts target_fields join_field m2m direct filtered_relation')\n    20\t\n    21\t\n    22\tclass InvalidQuery(Exception):\n    23\t    \"\"\"The query passed to raw() isn't a safe query to use with raw().\"\"\"\n    24\t    pass\n    26\t\n    25\t\n    27\tdef subclasses(cls):\n    28\t    yield cls\n    29\t    for subclass in cls.__subclasses__():\n    30\t        yield from subclasses(subclass)\n    31\t\n    33\tclass QueryWrapper:\n    32\t\n    34\t    \"\"\"\n    35\t    A type that indicates the contents are an SQL fragment and the associate\n    37\t    \"\"\"\n    38\t    contains_aggregate = False\n    39\t\n    40\t    def __init__(self, sql, params):\n    44\t        return self.data\n    42\t\n    45\t\n    46\t\n    47\tclass Q(tree.Node):\n    48\t    \"\"\"\n    49\t    Encapsulate filters as objects that can then be combined logically (using\n    50\t    `&` and `|`).\n    51\t    \"\"\"\n    52\t    # Connection types\n    53\t    AND = 'AND'\n    54\t    OR = 'OR'\n    56\t    conditional = True\n    58\t    def __init__(self, *args, _connector=None, _negated=False, **kwargs):\n    57\t\n    59\t        super().__init__(children=[*args, *sorted(kwargs.items())], connector=_connector, negated=_negated)\n    60\t\n    61\t    def _combine(self, other, conn):\n    62\t        if not isinstance(other, Q):\n    63\t            raise TypeError(other)\n    64\t\n    66\t        if not other:\n    67\t            return copy.deepcopy(self)\n    68\t        # Or if this Q is empty, ignore it and just use `other`.\n    69\t        elif not self:\n    71\t\n    70\t            return copy.deepcopy(other)\n    73\t        obj.connector = conn\n    74\t        obj.add(self, conn)\n    75\t        obj.add(other, conn)\n    76\t        return obj\n    78\t    def __or__(self, other):\n    79\t        return self._combine(other, self.OR)\n    80\t\n    81\t    def __and__(self, other):\n    82\t        return self._combine(other, self.AND)\n    84\t    def __invert__(self):\n    85\t        obj = type(self)()\n    87\t        obj.negate()\n    88\t        return obj\n    89\t\n    91\t        # We must promote any new joins to left outer joins so that when Q is\n    90\t    def resolve_expression(self, query=None, allow_joins=True, reuse=None, summarize=False, for_save=False):\n    92\t        # used as an expression, rows aren't filtered due to joins.\n    95\t        return clause\n    93\t        clause, joins = query._add_q(self, reuse, allow_joins=allow_joins, split_subq=False)\n    96\t\n    97\t    def deconstruct(self):\n    98\t        path = '%s.%s' % (self.__class__.__module__, self.__class__.__name__)\n   100\t            path = path.replace('django.db.models.query_utils', 'django.db.models')\n    99\t        if path.startswith('django.db.models.query_utils'):\n   102\t        if len(self.children) == 1 and not isinstance(self.children[0], Q):\n   101\t        args, kwargs = (), {}\n   103\t            child = self.children[0]\n   105\t        else:\n   104\t            kwargs = {child[0]: child[1]}\n   106\t            args = tuple(self.children)\n   108\t                kwargs = {'_connector': self.connector}\n   107\t            if self.connector != self.default:\n   109\t        if self.negated:\n   111\t        return path, args, kwargs\n   114\tclass DeferredAttribute:\n   112\t\n   116\t    A wrapper for a deferred-loading field. When the value is read from this\n   115\t    \"\"\"\n   118\t    \"\"\"\n   119\t    def __init__(self, field):\n   120\t        self.field = field\n   121\t\n   124\t        Retrieve and caches the value from the datastore on the first lookup.\n   122\t    def __get__(self, instance, cls=None):\n   125\t        Return the cached value.\n   126\t        \"\"\"\n   127\t        if instance is None:\n   128\t            return self\n   130\t        field_name = self.field.attname\n   131\t        if data.get(field_name, self) is self:\n   132\t            # Let's see if the field is part of the parent chain. If so we\n   134\t            val = self._check_parent_chain(instance)\n   137\t                val = getattr(instance, field_name)\n   136\t                instance.refresh_from_db(fields=[field_name])\n   138\t            data[field_name] = val\n   139\t        return data[field_name]\n   140\t\n   142\t        \"\"\"\n   141\t    def _check_parent_chain(self, instance):\n   144\t        loaded in the instance. This can be done if the to-be fetched\n   143\t        Check if the field value can be fetched from a parent field already\n   145\t        field is a primary key field.\n   148\t        link_field = opts.get_ancestor_link(self.field.model)\n   147\t        opts = instance._meta\n   149\t        if self.field.primary_key and self.field != link_field:\n   150\t            return getattr(instance, link_field.attname)\n   151\t        return None\n   152\t\n   153\t\n   154\tclass RegisterLookupMixin:\n   157\t    def _get_lookup(cls, lookup_name):\n   161\t    @functools.lru_cache(maxsize=None)\n   160\t    @classmethod\n   162\t    def get_lookups(cls):\n   165\t\n   163\t        class_lookups = [parent.__dict__.get('class_lookups', {}) for parent in inspect.getmro(cls)]\n   166\t    def get_lookup(self, lookup_name):\n   169\t        if found is None and hasattr(self, 'output_field'):\n   170\t            return self.output_field.get_lookup(lookup_name)\n   171\t        if found is not None and not issubclass(found, Lookup):\n   172\t            return None\n   174\t\n   175\t    def get_transform(self, lookup_name):\n   177\t        found = self._get_lookup(lookup_name)\n   176\t        from django.db.models.lookups import Transform\n   178\t        if found is None and hasattr(self, 'output_field'):\n   179\t            return self.output_field.get_transform(lookup_name)\n   180\t        if found is not None and not issubclass(found, Transform):\n   181\t            return None\n   183\t\n   184\t    @staticmethod\n   185\t    def merge_dicts(dicts):\n   187\t        Merge dicts in reverse to preference the order of the original list. e.g.,\n   188\t        merge_dicts([a, b]) will preference the keys in 'a' over those in 'b'.\n   189\t        \"\"\"\n   190\t        merged = {}\n   192\t            merged.update(d)\n   191\t        for d in reversed(dicts):\n   194\t\n   193\t        return merged\n   195\t    @classmethod\n   197\t        for subclass in subclasses(cls):\n   196\t    def _clear_cached_lookups(cls):\n   198\t            subclass.get_lookups.cache_clear()\n   199\t\n   200\t    @classmethod\n   201\t    def register_lookup(cls, lookup, lookup_name=None):\n   202\t        if lookup_name is None:\n   203\t            lookup_name = lookup.lookup_name\n   204\t        if 'class_lookups' not in cls.__dict__:\n   205\t            cls.class_lookups = {}\n   207\t        cls._clear_cached_lookups()\n   206\t        cls.class_lookups[lookup_name] = lookup\n   208\t        return lookup\n   209\t\n   211\t    def _unregister_lookup(cls, lookup, lookup_name=None):\n   213\t        Remove given lookup from cls lookups. For use in tests only as it's\n   215\t        \"\"\"\n   214\t        not thread-safe.\n   216\t        if lookup_name is None:\n   217\t            lookup_name = lookup.lookup_name\n   218\t        del cls.class_lookups[lookup_name]\n   219\t\n   222\t    \"\"\"\n   220\t\n   224\t    select_related() purposes. Used by both the query construction code\n   223\t    Return True if this field should be used to descend deeper for\n   225\t    (sql.query.fill_related_selections()) and the model instance creation code\n   226\t    (query.get_klass_info()).\n   228\t    Arguments:\n   227\t\n   229\t     * field - the field to be checked\n   231\t       manually restricted using a requested clause)\n   230\t     * restricted - a boolean field, indicating if the field list has been\n   232\t     * requested - The select_related() dictionary.\n   233\t     * load_fields - the set of fields to be loaded on this model\n   234\t     * reverse - boolean, True if we are checking a reverse select related\n   236\t    if not field.remote_field:\n   235\t    \"\"\"\n   237\t        return False\n   238\t    if field.remote_field.parent_link and not reverse:\n   239\t        return False\n   240\t    if restricted:",
      "applied_operators": [
        "text_perturbation"
      ]
    },
    {
      "action": "nl -ba django/db/models/base.py | sed -n '1,240p'",
      "original": "     1\timport copy\n     2\timport inspect\n     3\timport warnings\n     4\tfrom functools import partialmethod\n     5\tfrom itertools import chain\n     6\t\n     7\tfrom django.apps import apps\n     8\tfrom django.conf import settings\n     9\tfrom django.core import checks\n    10\tfrom django.core.exceptions import (\n    11\t    NON_FIELD_ERRORS, FieldDoesNotExist, FieldError, MultipleObjectsReturned,\n    12\t    ObjectDoesNotExist, ValidationError,\n    13\t)\n    14\tfrom django.db import (\n    15\t    DEFAULT_DB_ALIAS, DJANGO_VERSION_PICKLE_KEY, DatabaseError, connection,\n    16\t    connections, router, transaction,\n    17\t)\n    18\tfrom django.db.models import (\n    19\t    NOT_PROVIDED, ExpressionWrapper, IntegerField, Max, Value,\n    20\t)\n    21\tfrom django.db.models.constants import LOOKUP_SEP\n    22\tfrom django.db.models.constraints import CheckConstraint, UniqueConstraint\n    23\tfrom django.db.models.deletion import CASCADE, Collector\n    24\tfrom django.db.models.fields.related import (\n    25\t    ForeignObjectRel, OneToOneField, lazy_related_operation, resolve_relation,\n    26\t)\n    27\tfrom django.db.models.functions import Coalesce\n    28\tfrom django.db.models.manager import Manager\n    29\tfrom django.db.models.options import Options\n    30\tfrom django.db.models.query import Q\n    31\tfrom django.db.models.signals import (\n    32\t    class_prepared, post_init, post_save, pre_init, pre_save,\n    33\t)\n    34\tfrom django.db.models.utils import make_model_tuple\n    35\tfrom django.utils.encoding import force_str\n    36\tfrom django.utils.text import capfirst, get_text_list\n    37\tfrom django.utils.translation import gettext_lazy as _\n    38\tfrom django.utils.version import get_version\n    39\t\n    40\t\n    41\tclass Deferred:\n    42\t    def __repr__(self):\n    43\t        return '<Deferred field>'\n    44\t\n    45\t    def __str__(self):\n    46\t        return '<Deferred field>'\n    47\t\n    48\t\n    49\tDEFERRED = Deferred()\n    50\t\n    51\t\n    52\tdef subclass_exception(name, bases, module, attached_to):\n    53\t    \"\"\"\n    54\t    Create exception subclass. Used by ModelBase below.\n    55\t\n    56\t    The exception is created in a way that allows it to be pickled, assuming\n    57\t    that the returned exception class will be added as an attribute to the\n    58\t    'attached_to' class.\n    59\t    \"\"\"\n    60\t    return type(name, bases, {\n    61\t        '__module__': module,\n    62\t        '__qualname__': '%s.%s' % (attached_to.__qualname__, name),\n    63\t    })\n    64\t\n    65\t\n    66\tdef _has_contribute_to_class(value):\n    67\t    # Only call contribute_to_class() if it's bound.\n    68\t    return not inspect.isclass(value) and hasattr(value, 'contribute_to_class')\n    69\t\n    70\t\n    71\tclass ModelBase(type):\n    72\t    \"\"\"Metaclass for all models.\"\"\"\n    73\t    def __new__(cls, name, bases, attrs, **kwargs):\n    74\t        super_new = super().__new__\n    75\t\n    76\t        # Also ensure initialization is only performed for subclasses of Model\n    77\t        # (excluding Model class itself).\n    78\t        parents = [b for b in bases if isinstance(b, ModelBase)]\n    79\t        if not parents:\n    80\t            return super_new(cls, name, bases, attrs)\n    81\t\n    82\t        # Create the class.\n    83\t        module = attrs.pop('__module__')\n    84\t        new_attrs = {'__module__': module}\n    85\t        classcell = attrs.pop('__classcell__', None)\n    86\t        if classcell is not None:\n    87\t            new_attrs['__classcell__'] = classcell\n    88\t        attr_meta = attrs.pop('Meta', None)\n    89\t        # Pass all attrs without a (Django-specific) contribute_to_class()\n    90\t        # method to type.__new__() so that they're properly initialized\n    91\t        # (i.e. __set_name__()).\n    92\t        contributable_attrs = {}\n    93\t        for obj_name, obj in list(attrs.items()):\n    94\t            if _has_contribute_to_class(obj):\n    95\t                contributable_attrs[obj_name] = obj\n    96\t            else:\n    97\t                new_attrs[obj_name] = obj\n    98\t        new_class = super_new(cls, name, bases, new_attrs, **kwargs)\n    99\t\n   100\t        abstract = getattr(attr_meta, 'abstract', False)\n   101\t        meta = attr_meta or getattr(new_class, 'Meta', None)\n   102\t        base_meta = getattr(new_class, '_meta', None)\n   103\t\n   104\t        app_label = None\n   105\t\n   106\t        # Look for an application configuration to attach the model to.\n   107\t        app_config = apps.get_containing_app_config(module)\n   108\t\n   109\t        if getattr(meta, 'app_label', None) is None:\n   110\t            if app_config is None:\n   111\t                if not abstract:\n   112\t                    raise RuntimeError(\n   113\t                        \"Model class %s.%s doesn't declare an explicit \"\n   114\t                        \"app_label and isn't in an application in \"\n   115\t                        \"INSTALLED_APPS.\" % (module, name)\n   116\t                    )\n   117\t\n   118\t            else:\n   119\t                app_label = app_config.label\n   120\t\n   121\t        new_class.add_to_class('_meta', Options(meta, app_label))\n   122\t        if not abstract:\n   123\t            new_class.add_to_class(\n   124\t                'DoesNotExist',\n   125\t                subclass_exception(\n   126\t                    'DoesNotExist',\n   127\t                    tuple(\n   128\t                        x.DoesNotExist for x in parents if hasattr(x, '_meta') and not x._meta.abstract\n   129\t                    ) or (ObjectDoesNotExist,),\n   130\t                    module,\n   131\t                    attached_to=new_class))\n   132\t            new_class.add_to_class(\n   133\t                'MultipleObjectsReturned',\n   134\t                subclass_exception(\n   135\t                    'MultipleObjectsReturned',\n   136\t                    tuple(\n   137\t                        x.MultipleObjectsReturned for x in parents if hasattr(x, '_meta') and not x._meta.abstract\n   138\t                    ) or (MultipleObjectsReturned,),\n   139\t                    module,\n   140\t                    attached_to=new_class))\n   141\t            if base_meta and not base_meta.abstract:\n   142\t                # Non-abstract child classes inherit some attributes from their\n   143\t                # non-abstract parent (unless an ABC comes before it in the\n   144\t                # method resolution order).\n   145\t                if not hasattr(meta, 'ordering'):\n   146\t                    new_class._meta.ordering = base_meta.ordering\n   147\t                if not hasattr(meta, 'get_latest_by'):\n   148\t                    new_class._meta.get_latest_by = base_meta.get_latest_by\n   149\t\n   150\t        is_proxy = new_class._meta.proxy\n   151\t\n   152\t        # If the model is a proxy, ensure that the base class\n   153\t        # hasn't been swapped out.\n   154\t        if is_proxy and base_meta and base_meta.swapped:\n   155\t            raise TypeError(\"%s cannot proxy the swapped model '%s'.\" % (name, base_meta.swapped))\n   156\t\n   157\t        # Add remaining attributes (those with a contribute_to_class() method)\n   158\t        # to the class.\n   159\t        for obj_name, obj in contributable_attrs.items():\n   160\t            new_class.add_to_class(obj_name, obj)\n   161\t\n   162\t        # All the fields of any type declared on this model\n   163\t        new_fields = chain(\n   164\t            new_class._meta.local_fields,\n   165\t            new_class._meta.local_many_to_many,\n   166\t            new_class._meta.private_fields\n   167\t        )\n   168\t        field_names = {f.name for f in new_fields}\n   169\t\n   170\t        # Basic setup for proxy models.\n   171\t        if is_proxy:\n   172\t            base = None\n   173\t            for parent in [kls for kls in parents if hasattr(kls, '_meta')]:\n   174\t                if parent._meta.abstract:\n   175\t                    if parent._meta.fields:\n   176\t                        raise TypeError(\n   177\t                            \"Abstract base class containing model fields not \"\n   178\t                            \"permitted for proxy model '%s'.\" % name\n   179\t                        )\n   180\t                    else:\n   181\t                        continue\n   182\t                if base is None:\n   183\t                    base = parent\n   184\t                elif parent._meta.concrete_model is not base._meta.concrete_model:\n   185\t                    raise TypeError(\"Proxy model '%s' has more than one non-abstract model base class.\" % name)\n   186\t            if base is None:\n   187\t                raise TypeError(\"Proxy model '%s' has no non-abstract model base class.\" % name)\n   188\t            new_class._meta.setup_proxy(base)\n   189\t            new_class._meta.concrete_model = base._meta.concrete_model\n   190\t        else:\n   191\t            new_class._meta.concrete_model = new_class\n   192\t\n   193\t        # Collect the parent links for multi-table inheritance.\n   194\t        parent_links = {}\n   195\t        for base in reversed([new_class] + parents):\n   196\t            # Conceptually equivalent to `if base is Model`.\n   197\t            if not hasattr(base, '_meta'):\n   198\t                continue\n   199\t            # Skip concrete parent classes.\n   200\t            if base != new_class and not base._meta.abstract:\n   201\t                continue\n   202\t            # Locate OneToOneField instances.\n   203\t            for field in base._meta.local_fields:\n   204\t                if isinstance(field, OneToOneField):\n   205\t                    related = resolve_relation(new_class, field.remote_field.model)\n   206\t                    parent_links[make_model_tuple(related)] = field\n   207\t\n   208\t        # Track fields inherited from base models.\n   209\t        inherited_attributes = set()\n   210\t        # Do the appropriate setup for any model parents.\n   211\t        for base in new_class.mro():\n   212\t            if base not in parents or not hasattr(base, '_meta'):\n   213\t                # Things without _meta aren't functional models, so they're\n   214\t                # uninteresting parents.\n   215\t                inherited_attributes.update(base.__dict__)\n   216\t                continue\n   217\t\n   218\t            parent_fields = base._meta.local_fields + base._meta.local_many_to_many\n   219\t            if not base._meta.abstract:\n   220\t                # Check for clashes between locally declared fields and those\n   221\t                # on the base classes.\n   222\t                for field in parent_fields:\n   223\t                    if field.name in field_names:\n   224\t                        raise FieldError(\n   225\t                            'Local field %r in class %r clashes with field of '\n   226\t                            'the same name from base class %r.' % (\n   227\t                                field.name,\n   228\t                                name,\n   229\t                                base.__name__,\n   230\t                            )\n   231\t                        )\n   232\t                    else:\n   233\t                        inherited_attributes.add(field.name)\n   234\t\n   235\t                # Concrete classes...\n   236\t                base = base._meta.concrete_model\n   237\t                base_key = make_model_tuple(base)\n   238\t                if base_key in parent_links:\n   239\t                    field = parent_links[base_key]\n   240\t                elif not is_proxy:\n",
      "perturbed": "     2\timport inspect\n     1\timport copy\n     5\tfrom itertools import chain\n     3\timport warnings\n     6\t\n     7\tfrom django.apps import apps\n     8\tfrom django.conf import settings\n    10\tfrom django.core.exceptions import (\n    11\t    NON_FIELD_ERRORS, FieldDoesNotExist, FieldError, MultipleObjectsReturned,\n    12\t    ObjectDoesNotExist, ValidationError,\n    13\t)\n    14\tfrom django.db import (\n    16\t    connections, router, transaction,\n    15\t    DEFAULT_DB_ALIAS, DJANGO_VERSION_PICKLE_KEY, DatabaseError, connection,\n    17\t)\n    18\tfrom django.db.models import (\n    19\t    NOT_PROVIDED, ExpressionWrapper, IntegerField, Max, Value,\n    20\t)\n    22\tfrom django.db.models.constraints import CheckConstraint, UniqueConstraint\n    23\tfrom django.db.models.deletion import CASCADE, Collector\n    24\tfrom django.db.models.fields.related import (\n    25\t    ForeignObjectRel, OneToOneField, lazy_related_operation, resolve_relation,\n    26\t)\n    27\tfrom django.db.models.functions import Coalesce\n    29\tfrom django.db.models.options import Options\n    30\tfrom django.db.models.query import Q\n    32\t    class_prepared, post_init, post_save, pre_init, pre_save,\n    33\t)\n    34\tfrom django.db.models.utils import make_model_tuple\n    36\tfrom django.utils.text import capfirst, get_text_list\n    35\tfrom django.utils.encoding import force_str\n    37\tfrom django.utils.translation import gettext_lazy as _\n    38\tfrom django.utils.version import get_version\n    40\t\n    39\t\n    41\tclass Deferred:\n    43\t        return '<Deferred field>'\n    44\t\n    48\t\n    46\t        return '<Deferred field>'\n    49\tDEFERRED = Deferred()\n    50\t\n    52\tdef subclass_exception(name, bases, module, attached_to):\n    51\t\n    53\t    \"\"\"\n    54\t    Create exception subclass. Used by ModelBase below.\n    56\t    The exception is created in a way that allows it to be pickled, assuming\n    57\t    that the returned exception class will be added as an attribute to the\n    58\t    'attached_to' class.\n    59\t    \"\"\"\n    60\t    return type(name, bases, {\n    61\t        '__module__': module,\n    62\t        '__qualname__': '%s.%s' % (attached_to.__qualname__, name),\n    63\t    })\n    64\t\n    65\t\n    66\tdef _has_contribute_to_class(value):\n    68\t    return not inspect.isclass(value) and hasattr(value, 'contribute_to_class')\n    69\t\n    70\t\n    71\tclass ModelBase(type):\n    73\t    def __new__(cls, name, bases, attrs, **kwargs):\n    74\t        super_new = super().__new__\n    77\t        # (excluding Model class itself).\n    78\t        parents = [b for b in bases if isinstance(b, ModelBase)]\n    80\t            return super_new(cls, name, bases, attrs)\n    79\t        if not parents:\n    81\t\n    82\t        # Create the class.\n    83\t        module = attrs.pop('__module__')\n    86\t        if classcell is not None:\n    87\t            new_attrs['__classcell__'] = classcell\n    88\t        attr_meta = attrs.pop('Meta', None)\n    89\t        # Pass all attrs without a (Django-specific) contribute_to_class()\n    90\t        # method to type.__new__() so that they're properly initialized\n    92\t        contributable_attrs = {}\n    91\t        # (i.e. __set_name__()).\n    96\t            else:\n    94\t            if _has_contribute_to_class(obj):\n    97\t                new_attrs[obj_name] = obj\n    98\t        new_class = super_new(cls, name, bases, new_attrs, **kwargs)\n    99\t\n   101\t        meta = attr_meta or getattr(new_class, 'Meta', None)\n   102\t        base_meta = getattr(new_class, '_meta', None)\n   103\t\n   104\t        app_label = None\n   106\t        # Look for an application configuration to attach the model to.\n   105\t\n   107\t        app_config = apps.get_containing_app_config(module)\n   109\t        if getattr(meta, 'app_label', None) is None:\n   111\t                if not abstract:\n   110\t            if app_config is None:\n   113\t                        \"Model class %s.%s doesn't declare an explicit \"\n   112\t                    raise RuntimeError(\n   114\t                        \"app_label and isn't in an application in \"\n   115\t                        \"INSTALLED_APPS.\" % (module, name)\n   116\t                    )\n   117\t\n   121\t        new_class.add_to_class('_meta', Options(meta, app_label))\n   119\t                app_label = app_config.label\n   123\t            new_class.add_to_class(\n   122\t        if not abstract:\n   125\t                subclass_exception(\n   124\t                'DoesNotExist',\n   127\t                    tuple(\n   128\t                        x.DoesNotExist for x in parents if hasattr(x, '_meta') and not x._meta.abstract\n   131\t                    attached_to=new_class))\n   129\t                    ) or (ObjectDoesNotExist,),\n   132\t            new_class.add_to_class(\n   133\t                'MultipleObjectsReturned',\n   134\t                subclass_exception(\n   136\t                    tuple(\n   135\t                    'MultipleObjectsReturned',\n   137\t                        x.MultipleObjectsReturned for x in parents if hasattr(x, '_meta') and not x._meta.abstract\n   138\t                    ) or (MultipleObjectsReturned,),\n   140\t                    attached_to=new_class))\n   141\t            if base_meta and not base_meta.abstract:\n   142\t                # Non-abstract child classes inherit some attributes from their\n   143\t                # non-abstract parent (unless an ABC comes before it in the\n   146\t                    new_class._meta.ordering = base_meta.ordering\n   145\t                if not hasattr(meta, 'ordering'):\n   147\t                if not hasattr(meta, 'get_latest_by'):\n   148\t                    new_class._meta.get_latest_by = base_meta.get_latest_by\n   149\t\n   150\t        is_proxy = new_class._meta.proxy\n   151\t\n   153\t        # hasn't been swapped out.\n   154\t        if is_proxy and base_meta and base_meta.swapped:\n   156\t\n   157\t        # Add remaining attributes (those with a contribute_to_class() method)\n   159\t        for obj_name, obj in contributable_attrs.items():\n   160\t            new_class.add_to_class(obj_name, obj)\n   161\t\n   165\t            new_class._meta.local_many_to_many,\n   162\t        # All the fields of any type declared on this model\n   166\t            new_class._meta.private_fields\n   168\t        field_names = {f.name for f in new_fields}\n   167\t        )\n   169\t\n   170\t        # Basic setup for proxy models.\n   172\t            base = None\n   171\t        if is_proxy:\n   173\t            for parent in [kls for kls in parents if hasattr(kls, '_meta')]:\n   175\t                    if parent._meta.fields:\n   174\t                if parent._meta.abstract:\n   176\t                        raise TypeError(\n   178\t                            \"permitted for proxy model '%s'.\" % name\n   179\t                        )\n   180\t                    else:\n   181\t                        continue\n   182\t                if base is None:\n   183\t                    base = parent\n   184\t                elif parent._meta.concrete_model is not base._meta.concrete_model:\n   186\t            if base is None:\n   187\t                raise TypeError(\"Proxy model '%s' has no non-abstract model base class.\" % name)\n   188\t            new_class._meta.setup_proxy(base)\n   189\t            new_class._meta.concrete_model = base._meta.concrete_model\n   191\t            new_class._meta.concrete_model = new_class\n   192\t\n   193\t        # Collect the parent links for multi-table inheritance.\n   195\t        for base in reversed([new_class] + parents):\n   194\t        parent_links = {}\n   196\t            # Conceptually equivalent to `if base is Model`.\n   200\t            if base != new_class and not base._meta.abstract:\n   198\t                continue\n   202\t            # Locate OneToOneField instances.\n   201\t                continue\n   203\t            for field in base._meta.local_fields:\n   205\t                    related = resolve_relation(new_class, field.remote_field.model)\n   207\t\n   209\t        inherited_attributes = set()\n   208\t        # Track fields inherited from base models.\n   210\t        # Do the appropriate setup for any model parents.\n   211\t        for base in new_class.mro():\n   213\t                # Things without _meta aren't functional models, so they're\n   212\t            if base not in parents or not hasattr(base, '_meta'):\n   214\t                # uninteresting parents.\n   215\t                inherited_attributes.update(base.__dict__)\n   217\t\n   218\t            parent_fields = base._meta.local_fields + base._meta.local_many_to_many\n   219\t            if not base._meta.abstract:\n   220\t                # Check for clashes between locally declared fields and those\n   221\t                # on the base classes.\n   222\t                for field in parent_fields:\n   223\t                    if field.name in field_names:\n   224\t                        raise FieldError(\n   225\t                            'Local field %r in class %r clashes with field of '\n   226\t                            'the same name from base class %r.' % (\n   228\t                                name,\n   227\t                                field.name,\n   229\t                                base.__name__,\n   232\t                    else:\n   233\t                        inherited_attributes.add(field.name)\n   234\t\n   236\t                base = base._meta.concrete_model\n   235\t                # Concrete classes...\n   237\t                base_key = make_model_tuple(base)\n   239\t                    field = parent_links[base_key]\n   240\t                elif not is_proxy:",
      "applied_operators": [
        "text_perturbation"
      ]
    },
    {
      "action": "nl -ba django/db/models/fields/__init__.py | sed -n '720,820p'",
      "original": "   720\t\n   721\t    def get_db_converters(self, connection):\n   722\t        if hasattr(self, 'from_db_value'):\n   723\t            return [self.from_db_value]\n   724\t        return []\n   725\t\n   726\t    @property\n   727\t    def unique(self):\n   728\t        return self._unique or self.primary_key\n   729\t\n   730\t    @property\n   731\t    def db_tablespace(self):\n   732\t        return self._db_tablespace or settings.DEFAULT_INDEX_TABLESPACE\n   733\t\n   734\t    @property\n   735\t    def db_returning(self):\n   736\t        \"\"\"\n   737\t        Private API intended only to be used by Django itself. Currently only\n   738\t        the PostgreSQL backend supports returning multiple fields on a model.\n   739\t        \"\"\"\n   740\t        return False\n   741\t\n   742\t    def set_attributes_from_name(self, name):\n   743\t        self.name = self.name or name\n   744\t        self.attname, self.column = self.get_attname_column()\n   745\t        self.concrete = self.column is not None\n   746\t        if self.verbose_name is None and self.name:\n   747\t            self.verbose_name = self.name.replace('_', ' ')\n   748\t\n   749\t    def contribute_to_class(self, cls, name, private_only=False):\n   750\t        \"\"\"\n   751\t        Register the field with the model class it belongs to.\n   752\t\n   753\t        If private_only is True, create a separate instance of this field\n   754\t        for every subclass of cls, even if cls is not an abstract model.\n   755\t        \"\"\"\n   756\t        self.set_attributes_from_name(name)\n   757\t        self.model = cls\n   758\t        cls._meta.add_field(self, private=private_only)\n   759\t        if self.column:\n   760\t            # Don't override classmethods with the descriptor. This means that\n   761\t            # if you have a classmethod and a field with the same name, then\n   762\t            # such fields can't be deferred (we don't have a check for this).\n   763\t            if not getattr(cls, self.attname, None):\n   764\t                setattr(cls, self.attname, self.descriptor_class(self))\n   765\t        if self.choices is not None:\n   766\t            setattr(cls, 'get_%s_display' % self.name,\n   767\t                    partialmethod(cls._get_FIELD_display, field=self))\n   768\t\n   769\t    def get_filter_kwargs_for_object(self, obj):\n   770\t        \"\"\"\n   771\t        Return a dict that when passed as kwargs to self.model.filter(), would\n   772\t        yield all instances having the same value for this field as obj has.\n   773\t        \"\"\"\n   774\t        return {self.name: getattr(obj, self.attname)}\n   775\t\n   776\t    def get_attname(self):\n   777\t        return self.name\n   778\t\n   779\t    def get_attname_column(self):\n   780\t        attname = self.get_attname()\n   781\t        column = self.db_column or attname\n   782\t        return attname, column\n   783\t\n   784\t    def get_internal_type(self):\n   785\t        return self.__class__.__name__\n   786\t\n   787\t    def pre_save(self, model_instance, add):\n   788\t        \"\"\"Return field's value just before saving.\"\"\"\n   789\t        return getattr(model_instance, self.attname)\n   790\t\n   791\t    def get_prep_value(self, value):\n   792\t        \"\"\"Perform preliminary non-db specific value checks and conversions.\"\"\"\n   793\t        if isinstance(value, Promise):\n   794\t            value = value._proxy____cast()\n   795\t        return value\n   796\t\n   797\t    def get_db_prep_value(self, value, connection, prepared=False):\n   798\t        \"\"\"\n   799\t        Return field's value prepared for interacting with the database backend.\n   800\t\n   801\t        Used by the default implementations of get_db_prep_save().\n   802\t        \"\"\"\n   803\t        if not prepared:\n   804\t            value = self.get_prep_value(value)\n   805\t        return value\n   806\t\n   807\t    def get_db_prep_save(self, value, connection):\n   808\t        \"\"\"Return field's value prepared for saving into a database.\"\"\"\n   809\t        return self.get_db_prep_value(value, connection=connection, prepared=False)\n   810\t\n   811\t    def has_default(self):\n   812\t        \"\"\"Return a boolean of whether this field has a default value.\"\"\"\n   813\t        return self.default is not NOT_PROVIDED\n   814\t\n   815\t    def get_default(self):\n   816\t        \"\"\"Return the default value for this field.\"\"\"\n   817\t        return self._get_default()\n   818\t\n   819\t    @cached_property\n   820\t    def _get_default(self):\n",
      "perturbed": "   720\t\n   721\t    def get_db_converters(self, connection):\n   722\t        if hasattr(self, 'from_db_value'):\n   723\t            return [self.from_db_value]\n   724\t        return []\n   725\t\n   726\t    @property\n   727\t    def unique(self):\n   728\t        return self._unique or self.primary_key\n   729\t\n   730\t    @property\n   731\t    def db_tablespace(self):\n   732\t        return self._db_tablespace or settings.DEFAULT_INDEX_TABLESPACE\n   734\t    @property\n   733\t\n   735\t    def db_returning(self):\n   737\t        Private API intended only to be used by Django itself. Currently only\n   738\t        the PostgreSQL backend supports returning multiple fields on a model.\n   739\t        \"\"\"\n   740\t        return False\n   741\t\n   742\t    def set_attributes_from_name(self, name):\n   743\t        self.name = self.name or name\n   744\t        self.attname, self.column = self.get_attname_column()\n   746\t        if self.verbose_name is None and self.name:\ndebug: retrying operation\n   745\t        self.concrete = self.column is not None\n   747\t            self.verbose_name = self.name.replace('_', ' ')\n   748\t\n   749\t    def contribute_to_class(self, cls, name, private_only=False):\n   750\t        \"\"\"\n   751\t        Register the field with the model class it belongs to.\n   753\t        If private_only is True, create a separate instance of this field\n   752\t\n   755\t        \"\"\"\n   754\t        for every subclass of cls, even if cls is not an abstract model.\n   756\t        self.set_attributes_from_name(name)\n   757\t        self.model = cls\n   758\t        cls._meta.add_field(self, private=private_only)\n   760\t            # Don't override classmethods with the descriptor. This means that\n   759\t        if self.column:\n   761\t            # if you have a classmethod and a field with the same name, then\n   764\t                setattr(cls, self.attname, self.descriptor_class(self))\n   762\t            # such fields can't be deferred (we don't have a check for this).\n   766\t            setattr(cls, 'get_%s_display' % self.name,\n   765\t        if self.choices is not None:\n   768\t\n   767\t                    partialmethod(cls._get_FIELD_display, field=self))\n   769\t    def get_filter_kwargs_for_object(self, obj):\n   771\t        Return a dict that when passed as kwargs to self.model.filter(), would\n   772\t        yield all instances having the same value for this field as obj has.\n   773\t        \"\"\"\n   774\t        return {self.name: getattr(obj, self.attname)}\n   777\t        return self.name\n   775\t\n   778\t\n   779\t    def get_attname_column(self):\n   781\t        column = self.db_column or attname\n   782\t        return attname, column\n   783\t\n   784\t    def get_internal_type(self):\n   788\t        \"\"\"Return field's value just before saving.\"\"\"\n   786\t\n   789\t        return getattr(model_instance, self.attname)\n   790\t\n   793\t        if isinstance(value, Promise):\n   794\t            value = value._proxy____cast()\n   795\t        return value\n   796\t\n   798\t        \"\"\"\n   799\t        Return field's value prepared for interacting with the database backend.\n   800\t\n   801\t        Used by the default implementations of get_db_prep_save().\n   804\t            value = self.get_prep_value(value)\n   802\t        \"\"\"\n   805\t        return value\n   806\t\n   808\t        \"\"\"Return field's value prepared for saving into a database.\"\"\"\n   807\t    def get_db_prep_save(self, value, connection):\n   809\t        return self.get_db_prep_value(value, connection=connection, prepared=False)\n   810\t\n   813\t        return self.default is not NOT_PROVIDED\n   811\t    def has_default(self):\n   814\t\n   815\t    def get_default(self):\n   816\t        \"\"\"Return the default value for this field.\"\"\"\n   817\t        return self._get_default()\n   818\t\n   819\t    @cached_property\n   820\t    def _get_default(self):",
      "applied_operators": [
        "text_perturbation"
      ]
    },
    {
      "action": "grep -n \"def _setattr\\\\|def _get_setattr\\\\|_setattr(\" django/db/models/base.py || true",
      "original": "434:                _setattr(self, field.attname, val)\n441:                _setattr(self, field.attname, val)\n482:                    _setattr(self, field.name, rel_obj)\n485:                    _setattr(self, field.attname, val)\n495:                            _setattr(self, prop, kwargs[prop])\n",
      "perturbed": "434:                _setattr(self, field.attname, val)\n441:                _setattr(self, field.attname, val)\n485:                    _setattr(self, field.attname, val)\n482:                    _setattr(self, field.name, rel_obj)\n495:                            _setattr(self, prop, kwargs[prop])",
      "applied_operators": [
        "text_perturbation"
      ]
    },
    {
      "action": "grep -n \"def _setattr\\\\|_setattr =\" django/db/models/base.py || true",
      "original": "409:        _setattr = setattr\n",
      "perturbed": "409:        _setattr = setattr",
      "applied_operators": [
        "text_perturbation"
      ]
    },
    {
      "action": "python - <<'PY'\nfrom pathlib import Path\np = Path('django/db/models/enums.py')\ns = p.read_text()\nold = \"class Choices(enum.Enum, metaclass=ChoicesMeta):\\n    \\\"\\\"\\\"Class for creating enumerated choices.\\\"\\\"\\\"\\n    pass\"\nnew = \"class Choices(enum.Enum, metaclass=ChoicesMeta):\\n    \\\"\\\"\\\"Class for creating enumerated choices.\\\"\\\"\\\"\\n    def __str__(self):\\n        return str(self.value)\\n    pass\"\nif old in s:\n    s = s.replace(old, new)\n    p.write_text(s)\n    print('patched enums.py')\nelse:\n    print('pattern not found; aborting')\nPY\n&& python - <<'PY'\nfrom django.db.models.enums import TextChoices, IntegerChoices\nclass MyTextChoice(TextChoices):\n    FIRST = 'first', 'First'\nprint('TextChoice str:', str(MyTextChoice.FIRST))\nclass MyIntChoice(IntegerChoices):\n    ONE = 1, 'One'\nprint('IntegerChoice str:', str(MyIntChoice.ONE))\nPY",
      "original": "patched enums.py\nbash: -c: line 14: syntax error near unexpected token `&&'\nbash: -c: line 14: `&& python - <<'PY''\n",
      "perturbed": "bash: -c: line 14: syntax error near unexpected token `&&'",
      "applied_operators": [
        "text_perturbation"
      ]
    },
    {
      "action": "nl -ba django/db/models/enums.py | sed -n '1,240p'",
      "original": "     1\timport enum\n     2\t\n     3\tfrom django.utils.functional import Promise\n     4\t\n     5\t__all__ = ['Choices', 'IntegerChoices', 'TextChoices']\n     6\t\n     7\t\n     8\tclass ChoicesMeta(enum.EnumMeta):\n     9\t    \"\"\"A metaclass for creating a enum choices.\"\"\"\n    10\t\n    11\t    def __new__(metacls, classname, bases, classdict):\n    12\t        labels = []\n    13\t        for key in classdict._member_names:\n    14\t            value = classdict[key]\n    15\t            if (\n    16\t                isinstance(value, (list, tuple)) and\n    17\t                len(value) > 1 and\n    18\t                isinstance(value[-1], (Promise, str))\n    19\t            ):\n    20\t                *value, label = value\n    21\t                value = tuple(value)\n    22\t            else:\n    23\t                label = key.replace('_', ' ').title()\n    24\t            labels.append(label)\n    25\t            # Use dict.__setitem__() to suppress defenses against double\n    26\t            # assignment in enum's classdict.\n    27\t            dict.__setitem__(classdict, key, value)\n    28\t        cls = super().__new__(metacls, classname, bases, classdict)\n    29\t        cls._value2label_map_ = dict(zip(cls._value2member_map_, labels))\n    30\t        # Add a label property to instances of enum which uses the enum member\n    31\t        # that is passed in as \"self\" as the value to use when looking up the\n    32\t        # label in the choices.\n    33\t        cls.label = property(lambda self: cls._value2label_map_.get(self.value))\n    34\t        return enum.unique(cls)\n    35\t\n    36\t    def __contains__(cls, member):\n    37\t        if not isinstance(member, enum.Enum):\n    38\t            # Allow non-enums to match against member values.\n    39\t            return member in {x.value for x in cls}\n    40\t        return super().__contains__(member)\n    41\t\n    42\t    @property\n    43\t    def names(cls):\n    44\t        empty = ['__empty__'] if hasattr(cls, '__empty__') else []\n    45\t        return empty + [member.name for member in cls]\n    46\t\n    47\t    @property\n    48\t    def choices(cls):\n    49\t        empty = [(None, cls.__empty__)] if hasattr(cls, '__empty__') else []\n    50\t        return empty + [(member.value, member.label) for member in cls]\n    51\t\n    52\t    @property\n    53\t    def labels(cls):\n    54\t        return [label for _, label in cls.choices]\n    55\t\n    56\t    @property\n    57\t    def values(cls):\n    58\t        return [value for value, _ in cls.choices]\n    59\t\n    60\t\n    61\tclass Choices(enum.Enum, metaclass=ChoicesMeta):\n    62\t    \"\"\"Class for creating enumerated choices.\"\"\"\n    63\t    def __str__(self):\n    64\t        return str(self.value)\n    65\t    pass\n    66\t\n    67\t\n    68\tclass IntegerChoices(int, Choices):\n    69\t    \"\"\"Class for creating enumerated integer choices.\"\"\"\n    70\t    pass\n    71\t\n    72\t\n    73\tclass TextChoices(str, Choices):\n    74\t    \"\"\"Class for creating enumerated string choices.\"\"\"\n    75\t\n    76\t    def _generate_next_value_(name, start, count, last_values):\n    77\t        return name\n",
      "perturbed": "     1\timport enum\n     6\t\n     3\tfrom django.utils.functional import Promise\n     7\t\n    10\t\n    11\t    def __new__(metacls, classname, bases, classdict):\n    12\t        labels = []\n    13\t        for key in classdict._member_names:\n    14\t            value = classdict[key]\n    16\t                isinstance(value, (list, tuple)) and\n    17\t                len(value) > 1 and\n    18\t                isinstance(value[-1], (Promise, str))\n    19\t            ):\n    20\t                *value, label = value\n    21\t                value = tuple(value)\n    22\t            else:\n    23\t                label = key.replace('_', ' ').title()\n    25\t            # Use dict.__setitem__() to suppress defenses against double\n    26\t            # assignment in enum's classdict.\n    27\t            dict.__setitem__(classdict, key, value)\n    28\t        cls = super().__new__(metacls, classname, bases, classdict)\n    29\t        cls._value2label_map_ = dict(zip(cls._value2member_map_, labels))\n    31\t        # that is passed in as \"self\" as the value to use when looking up the\n    32\t        # label in the choices.\n    34\t        return enum.unique(cls)\n    33\t        cls.label = property(lambda self: cls._value2label_map_.get(self.value))\n    35\t\n    36\t    def __contains__(cls, member):\n    39\t            return member in {x.value for x in cls}\n    38\t            # Allow non-enums to match against member values.\n    40\t        return super().__contains__(member)\n    41\t\n    43\t    def names(cls):\n    45\t        return empty + [member.name for member in cls]\n    46\t\n    48\t    def choices(cls):\n    47\t    @property\n    49\t        empty = [(None, cls.__empty__)] if hasattr(cls, '__empty__') else []\n    50\t        return empty + [(member.value, member.label) for member in cls]\n    51\t\n    52\t    @property\n    54\t        return [label for _, label in cls.choices]\n    53\t    def labels(cls):\n    56\t    @property\n    55\t\n    57\t    def values(cls):\n    58\t        return [value for value, _ in cls.choices]\n    59\t\n    61\tclass Choices(enum.Enum, metaclass=ChoicesMeta):\n    63\t    def __str__(self):\n    64\t        return str(self.value)\n    65\t    pass\n    66\t\n    67\t\n    68\tclass IntegerChoices(int, Choices):\n    69\t    \"\"\"Class for creating enumerated integer choices.\"\"\"\n    70\t    pass\n    71\t\n    72\t\n    75\t\n    74\t    \"\"\"Class for creating enumerated string choices.\"\"\"\n    77\t        return name\n    76\t    def _generate_next_value_(name, start, count, last_values):",
      "applied_operators": [
        "text_perturbation"
      ]
    },
    {
      "action": "grep -n \"def save\\\\|def save_base\\\\|def create\\\\(\" -n django/db/models | sed -n '1,240p'",
      "original": "grep: Unmatched ( or \\(\n",
      "perturbed": "debug: retrying operation\ngrep: Unmatched ( or \\(",
      "applied_operators": [
        "text_perturbation"
      ]
    },
    {
      "action": "grep -R \"def __set__\" django | sed -n '1,240p'",
      "original": "django/db/models/fields/related_descriptors.py:    def __set__(self, instance, value):\ndjango/db/models/fields/related_descriptors.py:    def __set__(self, instance, value):\ndjango/db/models/fields/related_descriptors.py:    def __set__(self, instance, value):\ndjango/db/models/fields/related_descriptors.py:    def __set__(self, instance, value):\ndjango/db/models/fields/related_descriptors.py:    def __set__(self, instance, value):\ndjango/db/models/fields/files.py:    def __set__(self, instance, value):\ndjango/db/models/fields/files.py:    def __set__(self, instance, value):\ndjango/contrib/gis/db/models/proxy.py:    def __set__(self, instance, value):\ndjango/contrib/contenttypes/fields.py:    def __set__(self, instance, value):\n",
      "perturbed": "django/db/models/fields/related_descriptors.py:    def __set__(self, instance, value):\ndjango/db/models/fields/related_descriptors.py:    def __set__(self, instance, value):\ndjango/db/models/fields/related_descriptors.py:    def __set__(self, instance, value):\ndjango/db/models/fields/related_descriptors.py:    def __set__(self, instance, value):\ndjango/db/models/fields/related_descriptors.py:    def __set__(self, instance, value):\ndjango/db/models/fields/files.py:    def __set__(self, instance, value):\ndjango/db/models/fields/files.py:    def __set__(self, instance, value):\ndjango/contrib/gis/db/models/proxy.py:    def __set__(self, instance, value):\ndjango/contrib/contenttypes/fields.py:    def __set__(self, instance, value):",
      "applied_operators": [
        "text_perturbation"
      ]
    },
    {
      "action": "python3 - <<'PY'\nfrom pathlib import Path\nimport sys\np = Path('django/db/models/query_utils.py')\nif not p.exists():\n    print('file not found', file=sys.stderr); sys.exit(1)\ns = p.read_text()\nstart = s.find('class DeferredAttribute:')\nif start == -1:\n    print('DeferredAttribute class not found', file=sys.stderr); sys.exit(1)\nsub = s[start:]\nif 'def __set__(self, instance, value):' in sub:\n    print('DeferredAttribute.__set__ already present; nothing to do')\n    sys.exit(0)\n# Ensure import enum near top (within first 50 lines)\nhead_lines = s.splitlines()\nif not any(line.strip().startswith('import enum') for line in head_lines[:50]):\n    # Try to insert after the first block of imports (after the first \"import\" line)\n    for i, line in enumerate(head_lines[:50]):\n        if line.startswith('import ') or line.startswith('from '):\n            insert_at_line = i + 1\n    head_lines.insert(insert_at_line, 'import enum')\n    s = '\\n'.join(head_lines) + '\\n' + '\\n'.join(s.splitlines()[len(head_lines):])\n# Find insertion point: the first occurrence of 'return data[field_name]' after DeferredAttribute start\nretpos = s.find('return data[field_name]', start)\nif retpos == -1:\n    print('Could not find return data[field_name] in DeferredAttribute', file=sys.stderr); sys.exit(1)\nline_end = s.find('\\n', retpos)\nif line_end == -1:\n    insert_at = len(s)\nelse:\n    insert_at = line_end + 1\nsetter = (\n    \"    def __set__(self, instance, value):\\n\"\n    \"        \\\"\\\"\\\"Store the value on the instance, converting Enum members\\n\"\n    \"        to their underlying value so freshly assigned choices match\\n\"\n    \"        values loaded from the database.\\\"\\\"\\\"\\n\"\n    \"        if isinstance(value, enum.Enum):\\n\"\n    \"            value = value.value\\n\"\n    \"        instance.__dict__[self.field.attname] = value\\n\\n\"\n)\ns2 = s[:insert_at] + setter + s[insert_at:]\np.write_text(s2)\nprint('patched django/db/models/query_utils.py')\n\n# Quick runtime smoke test\ntry:\n    import importlib, django\n    from importlib import reload\n    # Reload the module to pick up changes\n    import django.db.models.query_utils as qu\n    reload(qu)\n    class DummyField:\n        def __init__(self, attname):\n            self.attname = attname\n    descriptor = qu.DeferredAttribute(DummyField('x'))\n    class C: x = descriptor\n    inst = C()\n    import enum as _enum\n    class E(_enum.Enum):\n        A = 'a'\n    descriptor.__set__(inst, E.A)\n    print('stored:', inst.__dict__.get('x'), 'type:', type(inst.__dict__.get('x')).__name__)\nexcept Exception as e:\n    print('test failed:', e, file=sys.stderr); sys.exit(1)\nPY",
      "original": "patched django/db/models/query_utils.py\nstored: a type: str\n",
      "perturbed": "info: continuing execution\nstored: a type: str",
      "applied_operators": [
        "text_perturbation"
      ]
    }
  ]
}